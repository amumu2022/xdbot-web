import{_ as ne,o as oe,c as re,M as J,$ as j,k as S,p as de,t as le,S as o,e as a,r as s,ag as N,h as M,aH as U,R as me,aJ as Z,aI as ee,N as se,aw as ge,d as fe,j as i,aG as te,f as l}from"./index-9cea40a6.js";import{g as _e,U as be,a as ye,s as he,b as K,c as ve,d as ke}from"./group-5566e468.js";import{_ as we}from"./TimeForm.vue_vue_type_script_setup_true_lang-054d23e5.js";import{u as xe}from"./hooks-a6049d28.js";import{u as Se}from"./useBasicLayout-7ee1042a.js";import{E as Me,i as ae}from"./xdteam-5bf4004a.js";import{D as Ce,P as Re}from"./delete-667b307a.js";import{u as Y}from"./hooks-678b71c4.js";import{P as $e}from"./lock-password-line-a641d5aa.js";import{M as ze}from"./more-filled-c44d3178.js";import{d as Fe}from"./search-cc37b371.js";const Be={props:{type:{type:String,default:"primary"},pulse:{type:Boolean,default:!1}}};function Pe(m,r,h,$,b,v){return oe(),re("span",{class:J(["sc-state",[{"sc-status-processing":h.pulse},"sc-state-bg--"+h.type]])},null,2)}const Te=ne(Be,[["render",Pe],["__scopeId","data-v-aa91d29e"]]),{isMobile:Q}=Se();function De(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!ge(m)}function ie(m){const r=j({bot_id:"",group_name:"",group_id:"",currentPage:1,pageSize:10}),h=S(0),$=S(),b=S([]),v=S(!0),f=S({}),{switchStyle:L}=xe(),B=j({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),c=de(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]),z=e=>(r.currentPage-1)*r.pageSize+e+1,W=()=>{Me(b,C)},C=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:z,minWidth:50},{label:"群聊名称",prop:"group_name"},{label:"群聊号码",prop:"group_id",minWidth:100},{label:"群头像",prop:"image",cellRenderer:({row:e})=>{if(ae(e.group_id)){const t=`https://p.qlogo.cn/gh/${e.group_id}/${e.group_id}/100`;return a("span",null,[a(s("el-image"),{style:"border-radius: 5px",fit:"cover","preview-teleported":!0,src:t,lazy:!0,"preview-src-list":Array.of(t),class:"w-[60px] h-[60px] align-middle"},null)])}return a("span",null,[a(s("el-avatar"),{style:"background-color: #77BBAA; color: #FFFFFF;"},{default:()=>[e.group_name[0]]})])},width:160},{label:"状态",prop:"enable",minWidth:80,cellRenderer:e=>{var t;return a(s("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=f.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":n=>e.row.enable=n,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:L.value,onChange:()=>q(e)},null)}},{label:"小管家",width:180,prop:"group_admin",cellRenderer:({row:e,props:t})=>a("div",{class:"tag-container",style:"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"},[e.group_admin.map(n=>a(s("el-tag"),{size:t.size,type:"",effect:"dark"},De(n)?n:{default:()=>[n]}))])},{label:"成员数",prop:"member",minWidth:100,cellRenderer:({row:e})=>a("span",{style:{color:"blue"}},[`${e.Ydata.member_count}/${e.Ydata.max_member_count}`])},{label:"授权",prop:"end_time",hide:!0,cellRenderer:({row:e})=>{var t;return(t=e.Auth)==null?void 0:t.end_time}},{label:"授权",prop:"auth",minWidth:60,cellRenderer({row:e}){var w,x;const t=(x=(w=e.data)==null?void 0:w.Auth)==null?void 0:x.end_time,n=new Date;let g="info";if(t){const F=new Date(t);g=n<F?"success":"danger"}return N(Te,{type:g,pulse:!0})}},{label:"操作",fixed:"right",width:60,slot:"operation"}],O=[{label:"序号",type:"index",index:z,minWidth:50},{label:"账号",prop:"user_id"},{label:"群名片",prop:"card",minWidth:100},{label:"昵称",prop:"nickname",minWidth:100},{label:"身份",prop:"role",minWidth:100,cellRenderer:({row:e})=>{if(e.role==="member")return a(s("el-tag"),{class:"ml-2",type:"info",dark:!0},{default:()=>[M("成员")]});if(e.role==="admin")return a(s("el-tag"),{class:"ml-2",type:"info",style:"background-color: #70CA57; color: white;",dark:!0},{default:()=>[M("管理员")]});if(e.role==="owner")return a(s("el-tag"),{class:"ml-2",type:"info",style:"background-color: #E5C416; color: white;",dark:!0},{default:()=>[M("群主")]})}},{label:"头像",prop:"image",cellRenderer:({row:e})=>{if(ae(e.user_id)){const t=`https://q1.qlogo.cn/g?b=qq&nk=${e.user_id}&s=640`;return a("span",null,[a(s("el-image"),{style:"border-radius: 5px",fit:"cover","preview-teleported":!0,src:t,lazy:!0,"preview-src-list":Array.of(t),class:"w-[60px] h-[60px] align-middle"},null)])}return a("span",null,[a(s("el-avatar"),{style:"background-color: #77BBAA; color: #FFFFFF;"},{default:()=>[e.nickname[0]]})])},width:160},{label:"入群时间",prop:"join_time",minWidth:120,formatter:({join_time:e})=>U(e*1e3).format("YYYY-MM-DD HH:mm:ss")},{label:"最近发言",prop:"last_sent_time",minWidth:120,formatter:({last_sent_time:e})=>U(e*1e3).format("YYYY-MM-DD HH:mm:ss")},{label:"禁言",prop:"shut_up_timestamp",minWidth:120,cellRenderer:({row:e})=>e.shut_up_timestamp===0||e.shut_up_timestamp<33159420?a("span",null,[M("未禁言")]):a("span",{style:{color:"red"}},[U(e.shut_up_timestamp*1e3).format("YYYY-MM-DD HH:mm:ss")])},{label:"操作",fixed:"right",width:60,slot:"operation"}];function P(e){h.value=e.length,m.value.setAdaptive()}function V(){h.value=0,m.value.getTableRef().clearSelection()}function q({row:e,index:t}){me.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.group_name}</strong>?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{f.value[t]=Object.assign({},f.value[t],{loading:!0});const n={bot:r.bot_id,group_id:e.group_id,group_status:e.enable};be(n).then(async g=>{g.code===200?setTimeout(()=>{f.value[t]=Object.assign({},f.value[t],{loading:!1}),o("已成功修改群状态",{type:"success"})},200):(o(`操作失败，${g.message}`,{type:"error"}),v.value=!1)})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function H(e){Z({title:"群成员列表",fullscreenIcon:!0,fullscreen:!!Q.value,draggable:!0,closeOnClickModal:!1,contentRenderer:()=>N(ue,{bot:r.bot_id,group_id:e.group_id})})}function p(e){var t,n;Z({title:"群聊授权",props:{formInline:{cluster:{managementList:e.group_admin},Auth:{end_time:(n=(t=e.data)==null?void 0:t.Auth)==null?void 0:n.end_time}}},draggable:!0,fullscreen:!!Q.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>N(we,{ref:$}),beforeSure:(g,{options:w})=>{const x=$.value.getRef(),F=w.props.formInline;function ce(){o(`您编辑了群号为${e.group_id}的这条数据`,{type:"success"}),g(),_()}x.validate(pe=>{pe&&(F.bot=r.bot_id,F.group_id=e.group_id,ye(F).then(async X=>{X.code===200?await ce():o(`操作失败，${X.message}`,{type:"error"})}))})}})}async function u(e){const t=await he(r.bot_id,e.group_id);t.success?o("退出成功",{type:"success"}):o(`操作失败，${t.message}`,{type:"error"}),_()}async function R(e){const t=await K(r.bot_id,e.group_id);t.success?o("群打卡成功",{type:"success"}):o(`操作失败，${t.message}`,{type:"error"}),_()}function k(e){o("界面设计中",{type:"error"})}function y(e){o("界面设计中",{type:"error"})}function T(e){o("界面设计中",{type:"error"})}function D(e){o("界面设计中",{type:"error"})}async function E(){const e=m.value.getTableRef().getSelectionRows(),t=ee(e,"group_id");if(t.length>10){o("操作失败，不能进行超过10组数据的操作",{type:"error"});return}o("批量退群操作进行中",{type:"warning"});for(let n=0;n<t.length;n++)try{if(!(await K(r.bot_id,t[n])).success){o(`操作失败，群号【${t[n]}】退出失败`,{type:"error"});break}if(n<t.length-1){const w=50+Math.random()*450;await new Promise(x=>setTimeout(x,w))}}catch{o(`操作失败，群号【${t[n]}】退出时发生错误`,{type:"error"});break}o("批量退群操作完成",{type:"success"})}async function G(){const e=m.value.getTableRef().getSelectionRows(),t=ee(e,"group_id");if(t.length>10){o("操作失败，不能进行超过10组数据的操作",{type:"error"});return}o("批量签到操作进行中",{type:"warning"});for(let n=0;n<t.length;n++)try{if(!(await K(r.bot_id,t[n])).success){o(`操作失败，群号${t[n]}签到失败`,{type:"error"});break}if(n<t.length-1){const w=50+Math.random()*450;await new Promise(x=>setTimeout(x,w))}}catch{o(`操作失败，群号${t[n]}签到时发生错误`,{type:"error"});break}o("批量签到操作完成",{type:"success"})}function I(e){r.currentPage=1,r.pageSize=e,_()}function d(e){r.currentPage=e,_()}async function _(){v.value=!0;const{data:e}=await ve(r.bot_id,se(r));b.value=e.results,B.total=e.total,setTimeout(()=>{v.value=!1},500)}const A=e=>{e&&(e.resetFields(),_())};return le(()=>{_e().then(e=>{e.success&&e.data.length>0?(r.bot_id=e.data[0],_()):o("当前没有机器人在线",{type:"warning"})})}),{form:r,loading:v,columns:C,columnMember:O,dataList:b,pagination:B,buttonClass:c,selectedNum:h,isMobile:Q,onSelectionCancel:V,handleSelectionChange:P,handleAuth:p,handleMegBox:k,handleMember:H,handleBlack:y,handleMemberBlack:T,handleKick:D,onSearch:_,QuitGroup:u,SignGroup:R,onbatchQuit:E,onbatchSign:G,resetForm:A,exportExcel:W,handleSizeChange:I,handleCurrentChange:d}}const Ue=Object.freeze(Object.defineProperty({__proto__:null,useRole:ie},Symbol.toStringTag,{value:"Module"})),Ae={class:"main"},Ye=fe({__name:"MemberList",props:{bot:{type:String,required:!0},group_id:{type:String,required:!0}},setup(m){const r=m,h=S(),$=S(),b=S([]),v=j({total:0,pageSize:20,currentPage:1,pageSizes:[20,50,100,150],background:!0});async function f(){C.value=!0;const p=await ke(r.bot,r.group_id,se(c));b.value=p.data.results,v.total=p.data.total,setTimeout(()=>{C.value=!1},500)}function L(p){c.currentPage=1,c.pageSize=p,f()}function B(p){c.currentPage=p,f()}const c=j({user_id:"",nickname:"",currentPage:1,pageSize:20});le(()=>{f()});function z(){const p=b.value,u=W(p,c.user_id,c.nickname);b.value=u}function W(p,u,R){return p.filter(k=>{const y=R?k.nickname.includes(R):!0;return(u?k.user_id.toString().includes(u):!0)&&y})}const{loading:C,columnMember:O,buttonClass:P,exportExcel:V,handleKick:q,handleMemberBlack:H}=ie($);return(p,u)=>{const R=s("el-input"),k=s("el-form-item"),y=s("el-button"),T=s("el-form"),D=s("el-dropdown-item"),E=s("el-dropdown-menu"),G=s("el-dropdown"),I=s("pure-table");return oe(),re("div",Ae,[a(T,{ref_key:"formRef",ref:h,inline:!0,model:c,class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]"},{default:i(()=>[a(k,{label:"用户账号：",prop:"user_id"},{default:i(()=>[a(R,{modelValue:c.user_id,"onUpdate:modelValue":u[0]||(u[0]=d=>c.user_id=d),placeholder:"请输入用户账号",clearable:"",class:"!w-[160px]",onKeyup:u[1]||(u[1]=te(d=>z(),["enter"]))},null,8,["modelValue"])]),_:1}),a(k,{label:"昵称：",prop:"nickname"},{default:i(()=>[a(R,{modelValue:c.nickname,"onUpdate:modelValue":u[2]||(u[2]=d=>c.nickname=d),placeholder:"请输入用户账号",clearable:"",class:"!w-[160px]",onKeyup:u[3]||(u[3]=te(d=>z(),["enter"]))},null,8,["modelValue"])]),_:1}),a(k,null,{default:i(()=>[a(y,{type:"primary",icon:l(Y)(l(Fe)),loading:l(C),onClick:z},{default:i(()=>[M(" 搜索 ")]),_:1},8,["icon","loading"])]),_:1})]),_:1},8,["model"]),a(l(Re),{title:"群成员列表",columns:l(O),onRefresh:f},{buttons:i(()=>[a(y,{type:"success",onClick:l(V)},{default:i(()=>[M("导出")]),_:1},8,["onClick"])]),default:i(({size:d,dynamicColumns:_})=>[a(I,{"row-key":"id",ref_key:"tableRef",ref:$,adaptive:"",stripe:"","align-whole":"center",showOverflowTooltip:"","table-layout":"auto",loading:l(C),size:d,data:b.value,columns:_,pagination:v,paginationSmall:d==="small","header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:L,onPageCurrentChange:B},{operation:i(({row:A})=>[a(G,null,{dropdown:i(()=>[a(E,null,{default:i(()=>[a(D,null,{default:i(()=>[a(y,{class:J(l(P)),link:"",type:"primary",size:d,icon:l(Y)(l(Ce)),onClick:e=>l(q)(A)},{default:i(()=>[M(" 踢出成员 ")]),_:2},1032,["class","size","icon","onClick"])]),_:2},1024),a(D,null,{default:i(()=>[a(y,{class:J(l(P)),link:"",type:"primary",size:d,icon:l(Y)(l($e)),onClick:e=>l(H)(A)},{default:i(()=>[M(" 加黑成员 ")]),_:2},1032,["class","size","icon","onClick"])]),_:2},1024)]),_:2},1024)]),default:i(()=>[a(y,{class:"ml-3 mt-[2px]",link:"",type:"primary",size:d,icon:l(Y)(l(ze))},null,8,["size","icon"])]),_:2},1024)]),_:2},1032,["loading","size","data","columns","pagination","paginationSmall","header-cell-style"])]),_:1},8,["columns"])])}}});const ue=ne(Ye,[["__scopeId","data-v-ee3b559c"]]),Ke=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{Ke as M,Ue as h,ie as u};
