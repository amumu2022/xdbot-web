import{$ as b,k as r,t as j,e as k,r as A,aH as E,R as L,S as t,aI as v,N as U,aJ as Y,ag as N}from"./index-9cea40a6.js";import{_ as O}from"./form.vue_vue_type_script_setup_true_lang-f2c90dc4.js";import{b as V,e as J,f as q,h as G,i as K,j as Q}from"./main-cbd39795.js";import{u as X}from"./useBasicLayout-7ee1042a.js";import{u as Z}from"./hooks-a6049d28.js";import{E as w}from"./xdteam-5bf4004a.js";import"./index-17695056.js";const{isMobile:C}=X();function ie(c){const s=b({name:"",enable:"",currentPage:1,pageSize:10}),m=r(),u=r([]),d=r(!0),g=r(0),o=r({}),{switchStyle:S}=Z(),f=b({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),D=e=>(s.currentPage-1)*s.pageSize+e+1,$=()=>{w(u,h)},h=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:D,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"商品分类",prop:"name",minWidth:120},{label:"描述",prop:"description",minWidth:300},{label:"状态",prop:"enable",minWidth:90,cellRenderer:e=>{var a;return k(A("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=o.value[e.index])==null?void 0:a.loading,modelValue:e.row.enable,"onUpdate:modelValue":l=>e.row.enable=l,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:S.value,onChange:()=>x(e)},null)}},{label:"修改时间",minWidth:180,prop:"update_time",formatter:({update_time:e})=>E(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function x({row:e,index:a}){L.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.name}</strong>分类吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{o.value[a]=Object.assign({},o.value[a],{loading:!0}),V(e.id).then(l=>{l.code===200?setTimeout(()=>{o.value[a]=Object.assign({},o.value[a],{loading:!1}),t("已成功修改分类状态",{type:"success"})},200):t(`操作失败，${l.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function M(e){J(e.id).then(async a=>{a.code===200?(t(`您删除了分类ID为${e.id}的这条数据`,{type:"success"}),await n()):t(`操作失败，${a.message}`,{type:"error"})})}function R(e){g.value=e.length,c.value.setAdaptive()}function z(){g.value=0,c.value.getTableRef().clearSelection()}function T(){const e=c.value.getTableRef().getSelectionRows();q(v(e,"id")).then(async a=>{a.code===200?(t(`已删除分类编号为 ${v(e,"id")} 的数据`,{type:"success"}),await n()):t(`操作失败，${a.message}`,{type:"error"}),c.value.getTableRef().clearSelection()})}function F(e){s.currentPage=1,s.pageSize=e,n()}function P(e){s.currentPage=e,n()}async function n(){d.value=!0;const{data:e}=await G(U(s));u.value=e.results,f.total=e.total,setTimeout(()=>{d.value=!1},500)}const B=e=>{e&&(e.resetFields(),n())};function H(e="新增",a){Y({title:`${e}分类`,props:{formInline:{title:e,name:(a==null?void 0:a.name)??"",description:(a==null?void 0:a.description)??"",enable:(a==null?void 0:a.enable)??1}},width:"46%",draggable:!0,fullscreenIcon:!0,fullscreen:!!C.value,closeOnClickModal:!1,contentRenderer:()=>N(O,{ref:m}),beforeSure:(l,{options:I})=>{const W=m.value.getRef(),p=I.props.formInline;function y(){t(`您${e}了分类为${p.name}的这条数据`,{type:"success"}),l(),n()}W.validate(_=>{_&&(e==="新增"?K(p).then(async i=>{i.code===200?await y():t(`操作失败，${i.message}`,{type:"error"})}):e==="编辑"&&Q(a==null?void 0:a.id,p).then(async i=>{i.code===200?await y():t(`操作失败，${i.message}`,{type:"error"})}))})}})}return j(()=>{n()}),{form:s,loading:d,columns:h,dataList:u,selectedNum:g,pagination:f,isMobile:C,exportExcel:$,onbatchDel:T,onSearch:n,resetForm:B,openDialog:H,handleDelete:M,onSelectionCancel:z,handleSizeChange:F,handleCurrentChange:P,handleSelectionChange:R}}export{ie as useRole};
