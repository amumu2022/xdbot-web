import{$ as C,k as f,t as L,e as u,r as g,h as D,aH as U,R as Y,S as l,aI as $,N as I,aJ as J,ag as q,aw as G}from"./index-9cea40a6.js";import K from"./detail-96dacb5a.js";import{_ as Q}from"./form.vue_vue_type_script_setup_true_lang-479dcd44.js";import{x as X,y as w,z as ee,A as ae,B as te,C as ne}from"./keyword-f71e92cf.js";import{u as le}from"./hooks-a6049d28.js";import{u as ie}from"./useBasicLayout-7ee1042a.js";import{E as se}from"./xdteam-5bf4004a.js";import"./index-17695056.js";const{isMobile:_}=ie();function M(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!G(i)}function me(i){const r=C({keyword:"",enable:"",currentPage:1,pageSize:10}),v=f(),m=f([]),h=f(!0),y=f(0),d=f({}),{switchStyle:R}=le(),x=C({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),B=e=>(r.currentPage-1)*r.pageSize+e+1,T=()=>{se(m,S)},S=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:B,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"关键词",prop:"keyword",minWidth:80},{label:"回复语句",prop:"answer",minWidth:160,align:"left"},{label:"状态",prop:"enable",minWidth:80,cellRenderer:e=>{var a;return u(g("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=d.value[e.index])==null?void 0:a.loading,modelValue:e.row.enable,"onUpdate:modelValue":t=>e.row.enable=t,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:R.value,onChange:()=>j(e)},null)}},{label:"转发个人",prop:"user",minWidth:180,cellRenderer:({row:e,props:a})=>{var o;const t=e.data.user_id.length>5,c=()=>{};return u("div",{class:"tag-container",style:"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"},[(o=e.data)==null?void 0:o.user_id.slice(0,5).map(n=>u(g("el-tag"),{size:a.size,type:"",effect:"dark"},M(n)?n:{default:()=>[n]})),t&&u(g("el-button"),{type:"primary",size:a.size,link:!0,onClick:c},{default:()=>[D("查看更多")]})])}},{label:"转发群聊",prop:"group",minWidth:180,cellRenderer:({row:e,props:a})=>{var o;const t=e.data.group_id.length>5,c=()=>{k("详情",e)};return u("div",{class:"tag-container",style:"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"},[(o=e.data)==null?void 0:o.group_id.slice(0,5).map(n=>u(g("el-tag"),{size:a.size,type:"warning",effect:"dark"},M(n)?n:{default:()=>[n]})),t&&u(g("el-button"),{type:"primary",size:a.size,link:!0,onClick:c},{default:()=>[D("查看更多")]})])}},{label:"修改时间",minWidth:180,prop:"update_time",formatter:({update_time:e})=>U(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function j({row:e,index:a}){Y.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.keyword}</strong>关键词吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{d.value[a]=Object.assign({},d.value[a],{loading:!0}),X(e.id).then(t=>{t.code===200?setTimeout(()=>{d.value[a]=Object.assign({},d.value[a],{loading:!1}),l("已成功修改关键词状态",{type:"success"})},200):l(`操作失败，${t.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function F(e){w(e.id).then(async a=>{a.code===200?(l(`您删除了关键词ID为${e.id}的这条数据`,{type:"success"}),await s()):l(`操作失败，${a.message}`,{type:"error"})})}function A(e){y.value=e.length,i.value.setAdaptive()}function W(){y.value=0,i.value.getTableRef().clearSelection()}function E(){const e=i.value.getTableRef().getSelectionRows();ee($(e,"id")).then(async a=>{a.code===200?(l(`已删除关键词编号为 ${$(e,"id")} 的数据`,{type:"success"}),await s()):l(`操作失败，${a.message}`,{type:"error"}),i.value.getTableRef().clearSelection()})}function P(e){r.currentPage=1,r.pageSize=e,s()}function Z(e){r.currentPage=e,s()}async function s(){h.value=!0;const{data:e}=await ae(I(r));m.value=e.results,x.total=e.total,setTimeout(()=>{h.value=!1},500)}const H=e=>{e&&(e.resetFields(),s())};function k(e="新增",a){var c,o;let t=Q;e==="详情"&&(t=K),J({title:`${e}关键词`,props:{formInline:{title:e,keyword:(a==null?void 0:a.keyword)??"",answer:(a==null?void 0:a.answer)??"",user:((c=a==null?void 0:a.data)==null?void 0:c.user_id)||[],group:((o=a==null?void 0:a.data)==null?void 0:o.group_id)||[]}},width:"46%",draggable:!0,fullscreenIcon:!0,fullscreen:!!_.value,closeOnClickModal:!1,contentRenderer:()=>q(t,{ref:v}),beforeSure:(n,{options:N})=>{const O=v.value.getRef(),b=N.props.formInline;function z(){l(`您${e}了关键词为${b.keyword}的这条数据`,{type:"success"}),n(),s()}if(e==="详情")return n(),null;O.validate(V=>{V&&(e==="新增"?te(b).then(async p=>{p.code===200?await z():l(`操作失败，${p.message}`,{type:"error"})}):e==="编辑"&&ne(a==null?void 0:a.id,b).then(async p=>{p.code===200?await z():l(`操作失败，${p.message}`,{type:"error"})}))})}})}return L(()=>{s()}),{isMobile:_,form:r,loading:h,columns:S,dataList:m,selectedNum:y,pagination:x,onbatchDel:E,onSearch:s,resetForm:H,exportExcel:T,openDialog:k,handleDelete:F,onSelectionCancel:W,handleSizeChange:P,handleCurrentChange:Z,handleSelectionChange:A}}export{me as useRole};
