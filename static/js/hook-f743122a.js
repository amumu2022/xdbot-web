import{$ as b,k as c,t as E,e as g,r as S,aH as L,R as N,S as n,aI as k,N as U,aJ as V,ag as Y,aw as I}from"./index-9cea40a6.js";import W from"./form-689629b2.js";import{b as _,e as J,f as q,h as G,i as K,j as Q}from"./keyword-f71e92cf.js";import{u as X}from"./useBasicLayout-7ee1042a.js";import{E as Z}from"./xdteam-5bf4004a.js";import{u as ee}from"./hooks-a6049d28.js";/* empty css              */import"./codeEditor-08c5f378.js";import"./index-17695056.js";const{isMobile:x}=X();function te(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!I(o)}function de(o){const s=b({keyword:void 0,enable:"",currentPage:1,pageSize:10}),m=c(),u=c([]),d=c(!0),p=c(0),y=b({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),D=e=>(s.currentPage-1)*s.pageSize+e+1,i=c({}),{switchStyle:$}=ee(),w=()=>{Z(u,h)},h=[{label:"列表",type:"selection",width:20},{label:"序号",type:"index",index:D,width:80},{label:"编号",hide:!0,prop:"id"},{label:"函数关键词",prop:"keyword",minWidth:380,cellRenderer:({row:e,props:t})=>g("div",{class:"tag-container",style:"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"},[e.keyword.map(a=>g(S("el-tag"),{size:t.size,type:"",effect:"dark"},te(a)?a:{default:()=>[a]}))])},{label:"状态",prop:"enable",minWidth:80,cellRenderer:e=>{var t;return g(S("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=i.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:$.value,onChange:()=>C(e)},null)}},{label:"修改时间",minWidth:160,prop:"update_time",formatter:({update_time:e})=>L(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function C({row:e,index:t}){N.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.keyword}</strong>关键词吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!0}),_(e.id).then(a=>{a.code===200?setTimeout(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!1}),n("已成功修改关键词状态",{type:"success"})},200):n(`操作失败，${a.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function z(e){J(e.id).then(async t=>{t.code===200?(n(`您删除了ID为${e.id}的这条数据`,{type:"success"}),await l()):n(`操作失败，${t.message}`,{type:"error"})})}function R(e){p.value=e.length,o.value.setAdaptive()}function M(){p.value=0,o.value.getTableRef().clearSelection()}function j(){const e=o.value.getTableRef().getSelectionRows();q(k(e,"id")).then(async t=>{t.code===200?(n(`已删除编号为 ${k(e,"id")} 的数据`,{type:"success"}),await l()):n(`操作失败，${t.message}`,{type:"error"}),o.value.getTableRef().clearSelection()})}function T(e){s.currentPage=1,s.pageSize=e,l()}function F(e){s.currentPage=e,l()}async function l(){d.value=!0;const e=U(s);e.keyword=e.keyword||[],Array.isArray(e.keyword)||(e.keyword=[e.keyword]);const{data:t}=await G(e);u.value=t.results,y.total=t.total,setTimeout(()=>{d.value=!1},500)}const A=e=>{e&&(e.resetFields(),l())};function P(e="新增",t){V({title:`${e}关键词`,props:{formInline:{title:e,keyword:(t==null?void 0:t.keyword)??[],code:(t==null?void 0:t.code)??""}},draggable:!0,fullscreenIcon:!0,width:"70%",fullscreen:!!x.value,closeOnClickModal:!1,contentRenderer:()=>Y(W,{ref:m}),beforeSure:(a,{options:B})=>{const H=m.value.getRef(),f=B.props.formInline;function v(){n(`您${e}了关键词为${f.keyword}的这条数据`,{type:"success"}),a(),l()}H.validate(O=>{O&&(e==="新增"?K(f).then(async r=>{r.code===200?await v():n(`操作失败，${r.message}`,{type:"error"})}):e==="编辑"&&Q(t==null?void 0:t.id,f).then(async r=>{r.code===200?await v():n(`操作失败，${r.message}`,{type:"error"})}))})}})}return E(()=>{l()}),{form:s,loading:d,columns:h,dataList:u,selectedNum:p,pagination:y,onbatchDel:j,exportExcel:w,onSearch:l,resetForm:A,openDialog:P,handleDelete:z,onSelectionCancel:M,handleSizeChange:T,handleCurrentChange:F,handleSelectionChange:R,isMobile:x}}export{de as useRole};
