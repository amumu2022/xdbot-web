import{aP as M,$ as p,k as s,t as R,S as n,e as f,r as $,aH as k,aI as m,N as W,aJ as A,ag as I}from"./index-9cea40a6.js";import{_ as T}from"./form.vue_vue_type_script_setup_true_lang-b0e2ccf7.js";import{i as Y,j as _,k as E}from"./upload-f057e19f.js";import{E as F}from"./xdteam-5bf4004a.js";import{u as H}from"./useBasicLayout-7ee1042a.js";const{clipboardValue:L,copied:N}=M(),{isMobile:j}=H();function q(r){const o=p({currentPage:1,pageSize:10}),g=s(),l=s([]),i=s(!0),c=s(0),u=p({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),h=e=>(o.currentPage-1)*o.pageSize+e+1,b=()=>{F(l,d)},y=e=>{L.value=e,N.value?n("链接已复制",{type:"success"}):n("复制失败",{type:"error"})},d=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:h,minWidth:90},{label:"图片编号",hide:!0,prop:"id"},{label:"图片名称",prop:"name",minWidth:200},{label:"图片",prop:"href",cellRenderer:({row:e})=>f($("el-image"),{fit:"cover","preview-teleported":!0,src:e.href,style:"border-radius: 5px","preview-src-list":Array.of(e.href),class:"w-[60px] h-[60px] align-middle"},null),width:160},{label:"mime类型",prop:"mime",minWidth:130},{label:"文件大小",prop:"size",minWidth:100,cellRenderer:({row:e})=>{const t=(e.size/1024).toFixed(2)+" MB";return f("span",{style:{color:"blue"}},[t])}},{label:"上传时间",minWidth:180,prop:"create_time",formatter:({create_time:e})=>k(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function v(e){Y(e.id).then(async t=>{t.code===200?(n(`您删除了图片ID为${e.id}的这条数据`,{type:"success"}),await a()):n(`操作失败，${t.message}`,{type:"error"})})}function S(e){c.value=e.length,r.value.setAdaptive()}function x(){c.value=0,r.value.getTableRef().clearSelection()}function w(){const e=r.value.getTableRef().getSelectionRows();_(m(e,"id")).then(async t=>{t.code===200?(n(`已删除图片编号为 ${m(e,"id")} 的数据`,{type:"success"}),await a()):n(`操作失败，${t.message}`,{type:"error"}),r.value.getTableRef().clearSelection()})}function z(e){o.currentPage=1,o.pageSize=e,a()}function C(e){o.currentPage=e,a()}async function a(){i.value=!0;const{data:e}=await E(W(o));l.value=e.results,u.total=e.total,setTimeout(()=>{i.value=!1},500)}const D=e=>{e&&(e.resetFields(),a())};function P(e="新增"){A({title:`${e}图片`,width:"40%",draggable:!0,showClose:!1,fullscreenIcon:!0,fullscreen:!!j.value,closeOnClickModal:!1,contentRenderer:()=>I(T,{ref:g}),beforeSure:t=>{t(),a()},beforeCancel:t=>{t(),a(),n("上传成功",{type:"success"})}})}return R(()=>{a()}),{form:o,loading:i,columns:d,dataList:l,selectedNum:c,pagination:u,onbatchDel:w,copyLinks:y,exportExcel:b,onSearch:a,resetForm:D,openDialog:P,handleDelete:v,onSelectionCancel:x,handleSizeChange:z,handleCurrentChange:C,handleSelectionChange:S}}export{q as useRole};
