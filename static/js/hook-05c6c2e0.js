import{aN as c,aP as T,$ as V,k as d,p as W,t as Y,S as l,e as i,b$ as z,c0 as H,h as b,aH as P,N as J,aJ as F,ag as S,r as k,aw as K}from"./index-9cea40a6.js";import I from"./form-6624e878.js";import{u as U}from"./useBasicLayout-7ee1042a.js";import{E as G}from"./xdteam-5bf4004a.js";import"./index-17695056.js";/* empty css              */import"./codeEditor-08c5f378.js";const q=a=>c.request("post","/api/file/folds/list",{data:a}),Q=a=>c.request("post","/api/file/folds/last/list",{data:a}),X=a=>c.request("post","/api/file/folds/read",{data:a}),Z=a=>c.request("post","/api/file/folds/add/file",{data:a}),w=a=>c.request("post","/api/file/folds/add/fold",{data:a}),A=a=>c.request("post","/api/file/folds/del",{data:a}),ee=a=>c.request("put","/api/file/folds/edit",{data:a}),{isMobile:x}=U();function te(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!K(a)}const{clipboardValue:ae,copied:ne}=T(),se=a=>{ae.value=a,ne.value&&l("复制成功",{type:"success"})};function de(){const a=V({currentPage:1,pageSize:10}),h=d(),f=d([]),o=d(!0),M=d(0),N=()=>{G(f,R)},p=d(""),C=d("");function O(){E(p.value)}const R=[{label:"序号",type:"index",minWidth:20},{label:"编号",prop:"id",hide:!0},{label:"路径",prop:"path",hide:!0},{label:"是否文件",prop:"isDir",hide:!0},{label:"后缀",prop:"extension",hide:!0},{label:"名称",prop:"name",sortable:!0,minWidth:120,cellRenderer:({row:t})=>{const e=()=>{D("打开",t)},n=s=>i("div",{style:"display: flex; align-items: center"},[i(k("el-icon"),null,te(s)?s:{default:()=>[s]}),i("span",null,[b("    ")]),i(k("el-button"),{type:t.isDir?"danger":"primary",onClick:e,link:!0},{default:()=>[t.name]})]);return t.isDir?n(i(z,null,null)):n(i(H,null,null))}},{label:"大小",sortable:!0,prop:"size",minWidth:80,cellRenderer:({row:t})=>i("div",null,[t.size,i("span",null,[b(" ")]),b("KB")])},{label:"修改时间",sortable:!0,minWidth:120,prop:"update_time",formatter:({update_time:t})=>P(t).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:150,slot:"operation"}];function j(t){A(t.id).then(async e=>{e.code===200?(l(`您删除了文件ID为${t.id}的这条数据`,{type:"success"}),await m()):l(`操作失败，${e.message}`,{type:"error"})})}const B=W(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);async function m(){o.value=!0;const{data:t}=await q(J(a));f.value=t.items,C.value=t.path,p.value=t.path,setTimeout(()=>{o.value=!1},500)}async function $(t){const e={route:t};o.value=!0;const{data:n}=await q(e);f.value=n.items,p.value=n.path,setTimeout(()=>{o.value=!1},500)}async function E(t){const e={route:t};o.value=!0;const{data:n}=await Q(e);f.value=n.items,p.value=n.path,setTimeout(()=>{o.value=!1},500)}function D(t="打开",e){if(t==="打开"){const n={route:e.path};e.isDir?$(e.path):X(n).then(async s=>{s.code===200?(e.content=s.data,F({title:`${t}文件`,props:{formInline:{title:t,content:(e==null?void 0:e.content)??"",extension:(e==null?void 0:e.extension)??"",name:(e==null?void 0:e.name)??"",parent_path:(e==null?void 0:e.parent_path)??"",path:(e==null?void 0:e.path)??""}},width:"46%",draggable:!0,fullscreen:!!x.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>S(I,{ref:h}),beforeSure:(v,{options:r})=>{const y=h.value.getRef(),g=r.props.formInline;function u(){l(`您编辑了文件为${g.name}的这条数据`,{type:"success"}),v(),$(e.parent_path)}y.validate(L=>{L&&ee(g).then(async _=>{_.code===200?await u():l(`操作失败，${_.message}`,{type:"error"})})})}})):l(`操作失败，${s.message}`,{type:"error"})});return}else if(t==="删除"){const n={path:e.path};A(n).then(async s=>{s.code===200?(l(`您删除了文件名为${e.name}的这条数据`,{type:"success"}),await m()):l(`操作失败，${s.message}`,{type:"error"})});return}F({title:`${t}`,props:{formInline:{title:t,content:(e==null?void 0:e.content)??"",name:(e==null?void 0:e.name)??"",path:(e==null?void 0:e.path)??""}},width:"46%",draggable:!0,fullscreen:!!x.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>S(I,{ref:h}),beforeSure:(n,{options:s})=>{const v=h.value.getRef(),r=s.props.formInline;function y(){l(`您${t}了文件为${r.name}的这条数据`,{type:"success"}),n(),m()}v.validate(g=>{g&&(t==="新增文件"?(r.path=p.value,Z(r).then(async u=>{u.code===200?await y():l(`操作失败，${u.message}`,{type:"error"})})):t==="新增文件夹"&&(r.path=p.value,w(r).then(async u=>{u.code===200?await y():l(`操作失败，${u.message}`,{type:"error"})})))})}})}return Y(async()=>{m()}),{form:a,loading:o,columns:R,dataList:f,exportExcel:N,selectedNum:M,isMobile:x,onSearch:m,copyString:se,BackRoute:O,buttonClass:B,openDialog:D,handleDelete:j}}export{de as useRole};
