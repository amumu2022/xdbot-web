import{aN as r,$ as y,k as i,t as N,e as v,r as T,aH as Y,S as o,aI as S,N as E,aJ as H,ag as W}from"./index-9cea40a6.js";import j from"./form-c3b30043.js";import{u as L}from"./useBasicLayout-7ee1042a.js";import{E as B}from"./xdteam-5bf4004a.js";import"./index-17695056.js";import"./codeEditor-08c5f378.js";const J=a=>r.request("post","/api/features/custom_func/list",{data:a}),O=a=>r.request("post","/api/features/custom_func/add",{data:a}),U=a=>{const n=`/api/features/custom_func/del/${a}`;return r.request("delete",n)},V=a=>r.request("delete","/api/features/custom_func/batch_remove",{data:a}),G=(a,n)=>r.request("put",`/api/features/custom_func/${a}/info`,{data:n}),{isMobile:b}=L();function te(a){const n=y({name:"",currentPage:1,pageSize:10}),f=i(),u=i([]),l=i(!0),d=i(0),m=y({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),x=e=>(n.currentPage-1)*n.pageSize+e+1,$=()=>{B(u,g)},g=[{label:"列表",type:"selection",width:20},{label:"序号",type:"index",index:x,width:80},{label:"编号",hide:!0,prop:"id"},{label:"函数名称",prop:"name",minWidth:120,cellRenderer:({row:e,props:t})=>v("div",{class:"tag-container",style:"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"},[v(T("el-tag"),{size:t.size,type:"",effect:"dark"},{default:()=>[e.name]})])},{label:"函数内容",prop:"code",minWidth:380},{label:"修改时间",minWidth:160,prop:"update_time",formatter:({update_time:e})=>Y(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function D(e){U(e.id).then(async t=>{t.code===200?(o(`您删除了ID为${e.id}的这条数据`,{type:"success"}),await s()):o(`操作失败，${t.message}`,{type:"error"})})}function F(e){d.value=e.length,a.value.setAdaptive()}function z(){d.value=0,a.value.getTableRef().clearSelection()}function R(){const e=a.value.getTableRef().getSelectionRows();V(S(e,"id")).then(async t=>{t.code===200?(o(`已删除编号为 ${S(e,"id")} 的数据`,{type:"success"}),await s()):o(`操作失败，${t.message}`,{type:"error"}),a.value.getTableRef().clearSelection()})}function C(e){n.currentPage=1,n.pageSize=e,s()}function _(e){n.currentPage=e,s()}async function s(){l.value=!0;const e=E(n),{data:t}=await J(e);u.value=t.results,m.total=t.total,setTimeout(()=>{l.value=!1},500)}const M=e=>{e&&(e.resetFields(),s())};function q(e="新增",t){H({title:`${e}函数`,props:{formInline:{title:e,name:(t==null?void 0:t.name)??[],code:(t==null?void 0:t.code)??""}},draggable:!0,fullscreenIcon:!0,width:"70%",fullscreen:!!b.value,closeOnClickModal:!1,contentRenderer:()=>W(j,{ref:f}),beforeSure:(I,{options:P})=>{const k=f.value.getRef(),p=P.props.formInline;function h(){o(`您${e}了函数名为${p.name}的这条数据`,{type:"success"}),I(),s()}k.validate(A=>{A&&(e==="新增"?O(p).then(async c=>{c.code===200?await h():o(`操作失败，${c.message}`,{type:"error"})}):e==="编辑"&&G(t==null?void 0:t.id,p).then(async c=>{c.code===200?await h():o(`操作失败，${c.message}`,{type:"error"})}))})}})}return N(()=>{s()}),{form:n,loading:l,columns:g,dataList:u,selectedNum:d,pagination:m,onbatchDel:R,exportExcel:$,onSearch:s,resetForm:M,openDialog:q,handleDelete:D,onSelectionCancel:z,handleSizeChange:C,handleCurrentChange:_,handleSelectionChange:F,isMobile:b}}export{te as useRole};
