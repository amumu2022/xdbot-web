import{_ as C}from"./form.vue_vue_type_script_setup_true_lang-b362985c.js";import{k as d,$ as S,t as j,e as p,aT as B,r as y,R as F,bz as I,S as l,bA as k,I as v,bB as W,aJ as U,D as V,ag as z,bC as A,bD as H,bE as N,aw as E}from"./index-9cea40a6.js";import{u as J}from"./hooks-d61f20df.js";import{u as P}from"./useBasicLayout-7ee1042a.js";import"./index-17695056.js";import"./hooks-678b71c4.js";function q(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!E(a)}const{isMobile:G}=P(),c=d({});function w(){const a=S({name:"",enable:""}),g=d(),r=d([]),f=d(!0),{switchStyle:_}=J(),D=[{label:"菜单编号",prop:"id",hide:!0},{label:"菜单名称",prop:"name",width:180,align:"left"},{label:"图标",prop:"icon",minWidth:60,cellRenderer:({row:n})=>p("div",{class:"flex justify-center"},[p(B,{icon:n.icon},null)])},{label:"状态",minWidth:130,cellRenderer:n=>{var e;return p(y("el-switch"),{size:n.props.size==="small"?"small":"default",loading:(e=c.value[n.index])==null?void 0:e.loading,modelValue:n.row.enable,"onUpdate:modelValue":t=>n.row.enable=t,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:_.value,onChange:()=>x(n)},null)}},{label:"打开类型",prop:"open_type",minWidth:70,cellRenderer:({row:n})=>{var o;const e=[{value:"按钮",text:"info"},{value:"签页内嵌",text:"warning"},{value:"外链跳转",text:"danger"},{value:"目录",text:"success"},{value:"菜单",text:null}],t=n.open_type==="0"?"目录":n.open_type==="1"?"菜单":n.open_type==="2"?"按钮":n.open_type==="3"?"签页内嵌":"外链跳转",m=(o=e.find(s=>s.value===t))==null?void 0:o.text;return p(y("el-tag"),{type:m,effect:"dark"},q(t)?t:{default:()=>[t]})}},{label:"权限标识",prop:"code",minWidth:120},{label:"排序",prop:"sort",minWidth:60},{label:"操作",fixed:"right",width:110,slot:"operation"}];function x({row:n,index:e}){F.confirm(`确认要<strong>${n.enable===0?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${n.name}</strong>菜单吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{c.value[e]=Object.assign({},c.value[e],{loading:!0}),I(n.id).then(t=>{t.code===200?setTimeout(()=>{c.value[e]=Object.assign({},c.value[e],{loading:!1}),l("已成功修改菜单状态",{type:"success"})},200):l(`操作失败，${t.message}`,{type:"error"})})}).catch(()=>{n.enable===0?n.enable=1:n.enable=0})}function M(n){}function T(n){n&&(n.resetFields(),i())}async function i(){f.value=!0;const{data:n}=await k();let e=n;v(a.name)||(e=e.filter(t=>t.name.includes(a.name))),v(a.enable)||(e=e.filter(t=>t.enable===a.enable)),r.value=W(e),setTimeout(()=>{f.value=!1},500)}function h(n){if(!n||!n.length)return;const e=[];for(let t=0;t<n.length;t++)n[t].disabled=n[t].enable===0,h(n[t].children),e.push(n[t]);return e}function $(n="新增",e){U({title:`${n}菜单`,props:{formInline:{title:n,higherMenuOptions:h(V(r.value)),parent_id:(e==null?void 0:e.parent_id)??"0",name:(e==null?void 0:e.name)??"",url:(e==null?void 0:e.url)??"",menu_name:(e==null?void 0:e.menu_name)??"",code:(e==null?void 0:e.code)??"",open_type:(e==null?void 0:e.open_type)??0,icon:(e==null?void 0:e.icon)??"ep:add-location",sort:(e==null?void 0:e.sort)??1}},width:"40%",draggable:!0,fullscreenIcon:!0,fullscreen:!!G.value,closeOnClickModal:!1,contentRenderer:()=>z(C,{ref:g}),beforeSure:(t,{options:m})=>{const o=g.value.getRef(),s=m.props.formInline;function b(){l(`您${n}了菜单名称为${s.name}的这条数据`,{type:"success"}),t(),i()}o.validate(R=>{R&&(delete s.higherMenuOptions,n==="新增"?A(s).then(async u=>{u.code===200?await b():l(`操作失败，${u.message}`,{type:"error"})}):n==="编辑"&&H(e==null?void 0:e.id,s).then(async u=>{u.code===200?await b():l(`操作失败，${u.message}`,{type:"error"})}))})}})}function O(n){N(n.id).then(async e=>{e.code===200?(l(`您删除了菜单名称为${n.name}的这条数据`,{type:"success"}),await i()):l(`操作失败，${e.message}`,{type:"error"})})}return j(()=>{i()}),{form:a,loading:f,columns:D,dataList:r,onSearch:i,resetForm:T,openDialog:$,handleDelete:O,handleSelectionChange:M}}export{w as useDept};
