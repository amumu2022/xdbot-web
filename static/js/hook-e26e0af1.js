import{$ as S,k as u,t as I,e as x,r as M,aH as O,R as U,S as n,aI as D,N as A,aJ as E,ag as L,aw as N}from"./index-9cea40a6.js";import{_ as V}from"./form.vue_vue_type_script_setup_true_lang-e257b6d2.js";import{U as Y,d as J,m as q,g as G,c as K,a as Q}from"./keyword-f71e92cf.js";import{u as X}from"./useBasicLayout-7ee1042a.js";import{u as Z}from"./hooks-a6049d28.js";import{E as ee}from"./xdteam-5bf4004a.js";import"./index-17695056.js";const{isMobile:$}=X();function te(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!N(l)}function ce(l){const o=S({keyword:"",answer:"",power:void 0,enable:void 0,currentPage:1,pageSize:10}),h=u(),p=u([]),f=u(!0),g=u(0),i=u({}),{switchStyle:C}=Z(),y=S({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),R=e=>(o.currentPage-1)*o.pageSize+e+1,T=()=>{ee(p,v)},v=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:R,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"菜单名称",prop:"keyword",minWidth:100},{label:"回复语句",prop:"answer",minWidth:200,align:"left"},{label:"菜单权限",prop:"power",minWidth:70,cellRenderer:({row:e})=>{var d;const t=[{value:"群员",text:"info"},{value:"管理",text:"warning"},{value:"群主",text:"danger"},{value:"超管",text:"success"},{value:"主人",text:null}],a=e.power===1?"群员":e.power===2?"管理":e.power===3?"群主":e.power===4?"超管":"主人",m=(d=t.find(r=>r.value===a))==null?void 0:d.text;return x(M("el-tag"),{type:m,effect:"dark"},te(a)?a:{default:()=>[a]})}},{label:"状态",prop:"enable",minWidth:90,cellRenderer:e=>{var t;return x(M("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=i.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已禁用","inline-prompt":!0,style:C.value,onChange:()=>k(e)},null)}},{label:"更新时间",minWidth:130,sortable:!0,prop:"update_time",formatter:({update_time:e})=>O(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function k({row:e,index:t}){U.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong>菜单编号为<strong style='color:var(--el-color-primary)'>${e.id}</strong>的菜单吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!0}),Y(e.id).then(a=>{a.code===200?setTimeout(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!1}),n("已成功修改菜单状态",{type:"success"})},200):n(`操作失败，${a.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function z(e){J(e.id).then(async t=>{t.code===200?(n(`您删除了菜单ID为${e.id}的这条数据`,{type:"success"}),await s()):n(`操作失败，${t.message}`,{type:"error"})})}function j(e){g.value=e.length,l.value.setAdaptive()}function w(){g.value=0,l.value.getTableRef().clearSelection()}function F(){const e=l.value.getTableRef().getSelectionRows();q(D(e,"id")).then(async t=>{t.code===200?(n(`已删除菜单编号为 ${D(e,"id")} 的数据`,{type:"success"}),await s()):n(`操作失败，${t.message}`,{type:"error"}),l.value.getTableRef().clearSelection()})}function P(e){o.currentPage=1,o.pageSize=e,s()}function W(e){o.currentPage=e,s()}async function s(){f.value=!0;const{data:e}=await G(A(o));p.value=e.results,y.total=e.total,setTimeout(()=>{f.value=!1},500)}const _=e=>{e&&(e.resetFields(),s())};function B(e="新增",t){E({title:`${e}菜单`,props:{formInline:{title:e,keyword:(t==null?void 0:t.keyword)??"",answer:(t==null?void 0:t.answer)??"",power:(t==null?void 0:t.power)??1}},width:"46%",draggable:!0,fullscreen:!!$.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>L(V,{ref:h}),beforeSure:(a,{options:m})=>{const d=h.value.getRef(),r=m.props.formInline;function b(){n(`您${e}了菜单编号为${r.id}的这条数据`,{type:"success"}),a(),s()}d.validate(H=>{H&&(e==="新增"?K(r).then(async c=>{c.code===200?await b():n(`操作失败，${c.message}`,{type:"error"})}):e==="编辑"&&Q(t==null?void 0:t.id,r).then(async c=>{c.code===200?await b():n(`操作失败，${c.message}`,{type:"error"})}))})}})}return I(async()=>{s()}),{form:o,loading:f,columns:v,dataList:p,exportExcel:T,selectedNum:g,pagination:y,isMobile:$,onbatchDel:F,onSearch:s,resetForm:_,openDialog:B,handleDelete:z,onSelectionCancel:w,handleSizeChange:P,handleCurrentChange:W,handleSelectionChange:j}}export{ce as useRole};
