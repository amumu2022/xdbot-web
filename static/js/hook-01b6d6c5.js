import{$ as m,k as r,t as M,e as f,h as R,r as W,aH as $,S as o,aI as h,N as B,aJ as E,ag as F}from"./index-9cea40a6.js";import{_ as P}from"./form.vue_vue_type_script_setup_true_lang-58d702da.js";import{b as T,e as _,f as I}from"./upload-f057e19f.js";import{E as N}from"./xdteam-5bf4004a.js";import{u as O}from"./useBasicLayout-7ee1042a.js";const{isMobile:Y}=O();function J(l){const n=m({currentPage:1,pageSize:10}),g=r(),s=r([]),i=r(!0),c=r(0),u=m({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),b=e=>(n.currentPage-1)*n.pageSize+e+1,y=()=>{N(s,d)},d=[{label:"列表",type:"selection",minWidth:40},{label:"序号",type:"index",index:b,minWidth:40},{label:"文件编号",hide:!0,prop:"id"},{label:"文件名称",prop:"name",minWidth:120},{label:"文件",prop:"href",cellRenderer:({row:e})=>f(W("el-button"),{type:"success",onClick:()=>p(e)},{default:()=>[R("点击下载")]})},{label:"mime类型",prop:"mime",minWidth:120},{label:"文件大小",prop:"size",minWidth:80,cellRenderer:({row:e})=>{const t=(e.size/1024).toFixed(2)+" MB";return f("span",{style:{color:"blue"}},[t])}},{label:"上传时间",minWidth:180,prop:"create_time",formatter:({create_time:e})=>$(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:60,slot:"operation"}];function p(e){const t=document.createElement("a");t.href=e.href,t.target="_blank",t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function S(e){T(e.id).then(async t=>{t.code===200?(o(`您删除了文件ID为${e.id}的这条数据`,{type:"success"}),await a()):o(`操作失败，${t.message}`,{type:"error"})})}function v(e){c.value=e.length,l.value.setAdaptive()}function C(){c.value=0,l.value.getTableRef().clearSelection()}function x(){const e=l.value.getTableRef().getSelectionRows();_(h(e,"id")).then(async t=>{t.code===200?(o(`已删除文件编号为 ${h(e,"id")} 的数据`,{type:"success"}),await a()):o(`操作失败，${t.message}`,{type:"error"}),l.value.getTableRef().clearSelection()})}function D(e){n.currentPage=1,n.pageSize=e,a()}function w(e){n.currentPage=e,a()}async function a(){i.value=!0;const{data:e}=await I(B(n));s.value=e.results,u.total=e.total,setTimeout(()=>{i.value=!1},500)}const z=e=>{e&&(e.resetFields(),a())};function k(e="新增"){E({title:`${e}文件`,width:"40%",draggable:!0,showClose:!1,fullscreenIcon:!0,fullscreen:!!Y.value,closeOnClickModal:!1,contentRenderer:()=>F(P,{ref:g}),beforeSure:t=>{t(),a()},beforeCancel:t=>{t(),a(),o("上传成功",{type:"success"})}})}return M(()=>{a()}),{form:n,loading:i,columns:d,dataList:s,selectedNum:c,pagination:u,onbatchDel:x,onSearch:a,exportExcel:y,resetForm:z,openDialog:k,handleDelete:S,onSelectionCancel:C,handleSizeChange:D,handleDownload:p,handleCurrentChange:w,handleSelectionChange:v}}export{J as useRole};
