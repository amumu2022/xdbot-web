import{aP as O,$ as v,k as u,t as U,e as m,r as B,h as k,aH as H,R as N,S as a,aI as S,N as K,aJ as L,ag as Y}from"./index-9cea40a6.js";import{_ as J}from"./form.vue_vue_type_style_index_0_lang-1d7506e8.js";import{U as G,d as q,m as Q,g as X,c as Z,a as w}from"./customApi-845cd991.js";import{u as ee}from"./hooks-a6049d28.js";import{E as te}from"./xdteam-5bf4004a.js";import{u as ae}from"./useBasicLayout-7ee1042a.js";import"./index-17695056.js";import"./hooks-678b71c4.js";import"./formPrimitive.vue_vue_type_script_setup_true_lang-37c6f8fb.js";const{clipboardValue:ne,copied:le}=O(),{isMobile:C}=ae();function me(d){const s=v({keyword:"",enable:"",method:"",url:"",currentPage:1,pageSize:10}),f=u(),o=u([]),p=u(!0),g=u(0),i=u({}),{switchStyle:D}=ee(),h=v({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),x=t=>(s.currentPage-1)*s.pageSize+t+1,P=()=>{te(o,y)},y=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:x,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"接口",prop:"keyword",minWidth:100},{label:"接口地址",prop:"url",minWidth:220},{label:"请求方式",prop:"method",minWidth:100},{label:"状态",prop:"enable",minWidth:80,cellRenderer:t=>{var e;return m(B("el-switch"),{size:t.props.size==="small"?"small":"default",loading:(e=i.value[t.index])==null?void 0:e.loading,modelValue:t.row.enable,"onUpdate:modelValue":n=>t.row.enable=n,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:D.value,onChange:()=>$(t)},null)}},{label:"请求类型",prop:"cookie",minWidth:120,cellRenderer:({row:t})=>t.cookie===""||t.cookie===null?m("span",{style:{color:"red"}},[k("不携带CK")]):m("span",{style:{color:"green"}},[k("携带CK")])},{label:"修改时间",minWidth:180,prop:"update_time",formatter:({update_time:t})=>H(t).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:150,slot:"operation"}];function $({row:t,index:e}){N.confirm(`确认要<strong>${t.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${t.keyword}</strong>接口吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[e]=Object.assign({},i.value[e],{loading:!0}),G(t.id).then(n=>{n.code===200?setTimeout(()=>{i.value[e]=Object.assign({},i.value[e],{loading:!1}),a("已成功修改接口状态",{type:"success"})},200):a(`操作失败，${n.message}`,{type:"error"})})}).catch(()=>{t.enable===0?t.enable=1:t.enable=0})}function I(t){q(t.id).then(async e=>{e.code===200?(a(`您删除了接口ID为${t.id}的这条数据`,{type:"success"}),await l()):a(`操作失败，${e.message}`,{type:"error"})})}function R(t){const e=n=>n?btoa(encodeURIComponent(n)):"";t.headers=e(t.headers),t.cookie=e(t.cookie),t.body=e(t.body),t.rule=e(t.rule),t.back_set=e(t.back_set),ne.value=JSON.stringify(t),le.value?a("导出成功",{type:"success"}):a("导出失败",{type:"warning"})}function j(t){g.value=t.length,d.value.setAdaptive()}function T(){g.value=0,d.value.getTableRef().clearSelection()}function _(){const t=d.value.getTableRef().getSelectionRows();Q(S(t,"id")).then(async e=>{e.code===200?(a(`已删除接口编号为 ${S(t,"id")} 的数据`,{type:"success"}),await l()):a(`操作失败，${e.message}`,{type:"error"}),d.value.getTableRef().clearSelection()})}function A(t){s.currentPage=1,s.pageSize=t,l()}function M(t){s.currentPage=t,l()}async function l(){p.value=!0;const{data:t}=await X(K(s));o.value=t.results,h.total=t.total,setTimeout(()=>{p.value=!1},500)}const z=t=>{t&&(t.resetFields(),l())};function E(t="新增",e){L({title:`${t}接口`,props:{formInline:{title:t,keyword:(e==null?void 0:e.keyword)??"",url:(e==null?void 0:e.url)??"",method:(e==null?void 0:e.method)??"GET",rule:(e==null?void 0:e.rule)??"",back_set:(e==null?void 0:e.back_set)??"",test:(e==null?void 0:e.test)??"",encode:(e==null?void 0:e.encode)??"utf-8",headers:(e==null?void 0:e.headers)??null,body:(e==null?void 0:e.body)??null,cookie:(e==null?void 0:e.cookie)??null,judge:(e==null?void 0:e.judge)??"no_judge",judgeValue:(e==null?void 0:e.judgeValue)??"200",judgeKey:(e==null?void 0:e.judgeKey)??"",time:(e==null?void 0:e.time)??10}},width:"46%",draggable:!0,fullscreenIcon:!0,fullscreen:!!C.value,closeOnClickModal:!1,contentRenderer:()=>Y(J,{ref:f}),beforeSure:(n,{options:F})=>{const V=f.value.getRef(),r=F.props.formInline;function b(){a(`您${t}了接口为${r.keyword}的这条数据`,{type:"success"}),n(),l()}V.validate(W=>{W&&(t==="新增"?Z(r).then(async c=>{c.code===200?await b():a(`操作失败，${c.message}`,{type:"error"})}):t==="编辑"&&w(e==null?void 0:e.id,r).then(async c=>{c.code===200?await b():a(`操作失败，${c.message}`,{type:"error"})}))})}})}return U(()=>{l()}),{form:s,loading:p,columns:y,dataList:o,selectedNum:g,pagination:h,isMobile:C,OutputFuc:R,exportExcel:P,onbatchDel:_,onSearch:l,resetForm:z,openDialog:E,handleDelete:I,onSelectionCancel:T,handleSizeChange:A,handleCurrentChange:M,handleSelectionChange:j}}export{me as useRole};
