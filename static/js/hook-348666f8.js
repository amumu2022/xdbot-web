import{aN as u,$ as S,k as m,t as T,e as f,r as b,h as q,aH as E,R as H,S as r,N as L,aJ as N,ag as O,aw as V}from"./index-9cea40a6.js";import{_ as W}from"./form.vue_vue_type_script_setup_true_lang-058ab54f.js";import U from"./detail-b626fac9.js";import{u as Y}from"./hooks-d61f20df.js";import{E as A}from"./xdteam-5bf4004a.js";import{u as I}from"./useBasicLayout-7ee1042a.js";const J=a=>u.request("post","/api/admin/role/list",{data:a}),G=a=>u.request("post","/api/admin/role/add",{data:a}),K=a=>{const o=`/api/admin/role/del/${a}`;return u.request("delete",o)},Q=a=>{const o=`/api/admin/role/${a}/status`;return u.request("put",o)},X=(a,o)=>u.request("put",`/api/admin/role/${a}/info`,{data:o});function Z(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!V(a)}const{isMobile:w}=I();function re(){const a=S({role_name:"",role_code:"",enable:"",currentPage:1,pageSize:10}),o=m(),g=m([]),h=m(!0),s=m({}),{switchStyle:$}=Y(),v=S({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),z=e=>(a.currentPage-1)*a.pageSize+e+1,C=()=>{A(g,_)},_=[{label:"序号",type:"index",index:z,minWidth:90},{label:"角色编号",hide:!0,prop:"id"},{label:"角色名称",prop:"role_name",minWidth:120},{label:"角色标识",prop:"role_code",minWidth:180,cellRenderer:({row:e,props:t})=>{var p;const n=()=>{x("详情",e)},d=e.role_code.length>5;return f("div",{class:"tag-container",style:"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"},[(p=e.role_code)==null?void 0:p.slice(0,5).map(i=>f(b("el-tag"),{size:t.size,type:"",effect:"dark"},Z(i)?i:{default:()=>[i]})),d&&f(b("el-button"),{type:"primary",size:t.size,link:!0,onClick:n},{default:()=>[q("查看更多")]})])}},{label:"状态",minWidth:100,cellRenderer:e=>{var t;return f(b("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=s.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":n=>e.row.enable=n,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:$.value,onChange:()=>M(e)},null)}},{label:"修改时间",minWidth:180,prop:"update_time",formatter:({update_time:e})=>E(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function M({row:e,index:t}){H.confirm(`确认要<strong>${e.enable===0?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.role_name}</strong>角色吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{s.value[t]=Object.assign({},s.value[t],{loading:!0}),Q(e.id).then(n=>{n.code===200?setTimeout(()=>{s.value[t]=Object.assign({},s.value[t],{loading:!1}),r("已成功修改角色状态",{type:"success"})},200):r(`操作失败，${n.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function D(e){K(e.id).then(async t=>{t.code===200?(r(`您删除了角色名称为${e.role_name}的这条数据`,{type:"success"}),await l()):r(`操作失败，${t.message}`,{type:"error"})})}function k(e){a.currentPage=1,a.pageSize=e,l()}function j(e){a.currentPage=e,l()}function B(e){}async function l(){h.value=!0;const{data:e}=await J(L(a));g.value=e.results,v.total=e.total,setTimeout(()=>{h.value=!1},500)}const F=e=>{e&&(e.resetFields(),l())};function x(e="新增",t){let n=W;e==="详情"&&(n=U),N({title:`${e}角色`,props:{formInline:{role_name:(t==null?void 0:t.role_name)??"",role_code:(t==null?void 0:t.role_code)??""}},width:"60%",draggable:!0,fullscreenIcon:!0,fullscreen:!!w.value,closeOnClickModal:!1,contentRenderer:()=>O(n,{ref:o}),beforeSure:(d,{options:p})=>{const i=o.value.getRef(),y=p.props.formInline;function R(){r(`您${e}了角色名称为${y.role_name}的这条数据`,{type:"success"}),d(),l()}if(e==="详情")return d(),null;i.validate(P=>{P&&(e==="新增"?G(y).then(async c=>{c.code===200?await R():r(`操作失败，${c.message}`,{type:"error"})}):e==="编辑"&&X(t==null?void 0:t.id,y).then(async c=>{c.code===200?await R():r(`操作失败，${c.message}`,{type:"error"})}))})}})}return T(()=>{l()}),{form:a,loading:h,columns:_,dataList:g,pagination:v,onSearch:l,resetForm:F,openDialog:x,handleDelete:D,exportExcel:C,handleSizeChange:k,handleCurrentChange:j,handleSelectionChange:B}}export{re as useRole};
