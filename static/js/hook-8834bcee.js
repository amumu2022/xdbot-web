import{$ as M,k as p,t as N,aH as R,S as a,aI as C,N as O,aJ as Y,ag as F}from"./index-9cea40a6.js";import I from"./form-cd12a50e.js";import{d as j,m as J,a as U,g as X,c as q,e as G}from"./dock-9ddcdacf.js";import{u as Q}from"./useBasicLayout-7ee1042a.js";import{E as V}from"./xdteam-5bf4004a.js";import"./codeEditor-08c5f378.js";import"./index-17695056.js";const{isMobile:A}=Q();function ce(u){const c=M({name:"",currentPage:1,pageSize:10}),m=p(),d=p([]),f=p(!0),g=p(0),b=M({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),H=e=>(c.currentPage-1)*c.pageSize+e+1,P=()=>{V(d,x)},x=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:H,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"脚本名称",prop:"name",minWidth:100},{label:"脚本路径",prop:"path",minWidth:80},{label:"脚本大小",prop:"size",minWidth:80},{label:"修改时间",minWidth:160,prop:"update_time",formatter:({update_time:e})=>R(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function T(e){j(e.id).then(async t=>{t.code===200?(a(`您删除了脚本ID为${e.id}的这条数据`,{type:"success"}),await s()):a(`操作失败，${t.message}`,{type:"error"})})}const h=p();function W(e){g.value=e.length,u.value.setAdaptive()}function k(){g.value=0,u.value.getTableRef().clearSelection()}function E(){const e=u.value.getTableRef().getSelectionRows();J(C(e,"id")).then(async t=>{t.code===200?(a(`已删除脚本编号为 ${C(e,"id")} 的数据`,{type:"success"}),await s()):a(`操作失败，${t.message}`,{type:"error"}),u.value.getTableRef().clearSelection()})}function _(e){c.currentPage=1,c.pageSize=e,s()}function B(e){c.currentPage=e,s()}async function s(){f.value=!0;const{data:e}=await U(O(c));d.value=e.results,b.total=e.total,setTimeout(()=>{f.value=!1},500)}const K=e=>{e&&(e.resetFields(),s())};function L(e="新增",t){const z=`# -*- coding:utf-8 -*-
"""
@Created on : ${R().format("YYYY/MM/DD HH:mm:ss")}
@Author: XDTEAM
@Des: 
"""

`;e==="编辑"?X(t==null?void 0:t.name).then(async r=>{if(r.code!==200)return a(`操作失败，${r.message}`,{type:"error"}),"";h.value=r.data,Y({title:`${e}脚本`,props:{formInline:{title:e,name:(t==null?void 0:t.name)??"",content:h.value??z}},draggable:!0,fullscreen:!0,closeOnClickModal:!1,contentRenderer:()=>F(I,{ref:m}),beforeSure:(y,{options:S})=>{const n=m.value.getRef(),o=S.props.formInline;n.validate(v=>{if(v){const i=o.content,D=i.length/1024;o.name.slice(-3)!==".py"&&(o.name=o.name+".py");const $={content:i,size:`${D.toFixed(2)}KB`,name:o.name,path:`/scripts/${o.name}`};q(t==null?void 0:t.id,$).then(async l=>{l.code===200?(a("操作成功，请稍后手动刷新",{type:"success"}),y()):a(`操作失败，${l.message}`,{type:"error"})})}})}})}):Y({title:`${e}脚本`,props:{formInline:{title:e,name:(t==null?void 0:t.name)??"",content:h.value??z}},draggable:!0,width:"70%",fullscreenIcon:!0,fullscreen:!!A.value,closeOnClickModal:!1,contentRenderer:()=>F(I,{ref:m}),beforeSure:(r,{options:y})=>{const S=m.value.getRef(),n=y.props.formInline;function o(){a(`您${e}了脚本为${n.name}的这条数据`,{type:"success"}),r(),s()}S.validate(v=>{if(v){const i=n.content;if(i==="")a("操作失败，脚本内容不符合要求",{type:"error"});else{const D=i.length/1024;n.name.slice(-3)!==".py"&&(n.name=n.name+".py");const $={content:i,size:`${D.toFixed(2)}KB`,name:n.name,path:`/scripts/${n.name}`};G($).then(async l=>{l.code===200?(a("操作成功",{type:"success"}),await o()):a(`操作失败，${l.message}`,{type:"error"})})}}})}})}return N(()=>{s()}),{form:c,loading:f,columns:x,dataList:d,selectedNum:g,pagination:b,isMobile:A,onbatchDel:E,exportExcel:P,onSearch:s,resetForm:K,openDialog:L,handleDelete:T,onSelectionCancel:k,handleSizeChange:_,handleCurrentChange:B,handleSelectionChange:W}}export{ce as useRole};
