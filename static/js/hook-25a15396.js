import{aN as u,al as O,p as D,$ as x,k as p,t as U,e as h,r as $,aH as b,R as j,S as s,aI as M,N as V,aJ as J,ag as X}from"./index-9cea40a6.js";import{_ as G}from"./form.vue_vue_type_script_setup_true_lang-a6139538.js";import K from"./description-14d59a01.js";import{u as Q}from"./useBasicLayout-7ee1042a.js";import{E as Z}from"./xdteam-5bf4004a.js";import"./index-17695056.js";const w=a=>u.request("post","/api/account/skey/list",{data:a}),ee=a=>u.request("post","/api/account/skey/add",{data:a}),te=a=>{const n=`/api/account/skey/del/${a}`;return u.request("delete",n)},ae=a=>u.request("delete","/api/account/skey/batch_remove",{data:a}),ne=a=>{const n=`/api/account/skey/${a}/status`;return u.request("put",n)},se=(a,n)=>u.request("put",`/api/account/skey/${a}/info`,{data:n});function le(){const{isDark:a}=O(),n=D(()=>({"--el-switch-on-color":"#6abe39","--el-switch-off-color":"#e84749"})),f=D(()=>c=>c===1?{"--el-tag-text-color":a.value?"#6abe39":"#389e0d","--el-tag-bg-color":a.value?"#172412":"#f6ffed","--el-tag-border-color":a.value?"#274a17":"#b7eb8f"}:{"--el-tag-text-color":a.value?"#e84749":"#cf1322","--el-tag-bg-color":a.value?"#2b1316":"#fff1f0","--el-tag-border-color":a.value?"#58191c":"#ffa39e"});return{isDark:a,switchStyle:n,tagStyle:f}}const{isMobile:_}=Q();function pe(a){const n=x({parent:"",skey:"",user:"",enable:void 0,status:void 0,currentPage:1,pageSize:10}),f=p(),c=p([]),m=p(!0),g=p(0),o=p({}),{switchStyle:R}=le(),y=x({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),z=t=>(n.currentPage-1)*n.pageSize+t+1,C=()=>{Z(c,v)},T=[{value:"群聊出租",text:"群聊出租"},{value:"宠物卡密",text:"宠物卡密"}],v=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:z,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"所属应用",prop:"parent",minWidth:120},{label:"卡密",prop:"skey",minWidth:140},{label:"秒数",sortable:!0,prop:"seconds",minWidth:80},{label:"点数",sortable:!0,prop:"points",minWidth:80},{label:"状态",prop:"enable",minWidth:90,cellRenderer:t=>{var e;return h($("el-switch"),{size:t.props.size==="small"?"small":"default",loading:(e=o.value[t.index])==null?void 0:e.loading,modelValue:t.row.enable,"onUpdate:modelValue":i=>t.row.enable=i,"active-value":!0,"inactive-value":!1,"active-text":"可激活","inactive-text":"已禁用","inline-prompt":!0,style:R.value,onChange:()=>W(t)},null)}},{label:"创建时间",minWidth:120,sortable:!0,prop:"create_time",formatter:({create_time:t})=>b(t).format("YYYY-MM-DD HH:mm:ss")},{label:"使用人",prop:"user",hide:!0,minWidth:100},{label:"卡密状态",prop:"status",minWidth:100,cellRenderer:({row:t,props:e})=>h($("el-tag"),{size:e.size,type:t.status?"danger":"success",effect:"dark"},{default:()=>[t.status?"已使用":"未使用"]})},{label:"使用时间",sortable:!0,minWidth:120,prop:"use_time",cellRenderer:({row:t})=>{let e="";return t.use_time?e=b(t.use_time).format("YYYY-MM-DD HH:mm:ss"):e="",h("div",null,[e])}},{label:"操作",fixed:"right",width:150,slot:"operation"}];function W({row:t,index:e}){j.confirm(`确认要<strong>${t.enable===!1?"停用":"启用"}</strong>卡密编号为<strong style='color:var(--el-color-primary)'>${t.id}</strong>的卡密吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{o.value[e]=Object.assign({},o.value[e],{loading:!0}),ne(t.id).then(i=>{i.code===200?setTimeout(()=>{o.value[e]=Object.assign({},o.value[e],{loading:!1}),s("已成功修改卡密状态",{type:"success"})},200):s(`操作失败，${i.message}`,{type:"error"})})}).catch(()=>{t.enable===0?t.enable=1:t.enable=0})}function Y(t){te(t.id).then(async e=>{e.code===200?(s(`您删除了卡密ID为${t.id}的这条数据`,{type:"success"}),await l()):s(`操作失败，${e.message}`,{type:"error"})})}function H(t){g.value=t.length,a.value.setAdaptive()}function q(){g.value=0,a.value.getTableRef().clearSelection()}function E(){const t=a.value.getTableRef().getSelectionRows();ae(M(t,"id")).then(async e=>{e.code===200?(s(`已删除卡密编号为 ${M(t,"id")} 的数据`,{type:"success"}),await l()):s(`操作失败，${e.message}`,{type:"error"}),a.value.getTableRef().clearSelection()})}function F(t){n.currentPage=1,n.pageSize=t,l()}function I(t){n.currentPage=t,l()}async function l(){m.value=!0;const{data:t}=await w(V(n));c.value=t.results,y.total=t.total,setTimeout(()=>{m.value=!1},500)}const P=t=>{t&&(t.resetFields(),l())};function A(t="新增",e){let i=G;t==="查看"&&(i=K),J({title:`${t}卡密`,props:{formInline:{title:t,parent:(e==null?void 0:e.parent)??"",id:(e==null?void 0:e.id)??null,points:(e==null?void 0:e.points)??0,seconds:(e==null?void 0:e.seconds)??1,status:(e==null?void 0:e.status)??!1,enable:(e==null?void 0:e.enable)??!1,heard:(e==null?void 0:e.heard)??"XDTEAM",skey:(e==null?void 0:e.skey)??"",user:(e==null?void 0:e.user)??"",use_time:(e==null?void 0:e.use_time)??void 0,num:(e==null?void 0:e.num)??1}},width:"46%",draggable:!0,fullscreen:!!_.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>X(i,{ref:f}),beforeSure:(S,{options:B})=>{const L=f.value.getRef(),r=B.props.formInline;function k(){s(`您${t}了卡密编号为${r.id}的这条数据`,{type:"success"}),S(),l()}L.validate(N=>{N&&(t==="新增"?ee(r).then(async d=>{d.code===200?await k():s(`操作失败，${d.message}`,{type:"error"})}):t==="编辑"?(r.user&&(r.use_time=b().valueOf()),se(e==null?void 0:e.id,r).then(async d=>{d.code===200?await k():s(`操作失败，${d.message}`,{type:"error"})})):S())})}})}return U(async()=>{l()}),{form:n,loading:m,columns:v,dataList:c,exportExcel:C,selectedNum:g,pagination:y,isMobile:_,parentTypes:T,onbatchDel:E,onSearch:l,resetForm:P,openDialog:A,handleDelete:Y,onSelectionCancel:q,handleSizeChange:F,handleCurrentChange:I,handleSelectionChange:H}}export{pe as useRole};
