import{_ as j}from"./form.vue_vue_type_script_setup_true_lang-41753a1c.js";import{k as d,Y as C,t as I,e as p,aV as S,r as y,aN as F,bu as k,ay as l,bv as B,I as v,bw as V,aI as W,D as U,ae as z,bx as H,by as N,bz as A,aK as K}from"./index-6f723797.js";import{u as P}from"./hooks-b016e2d4.js";import{u as Y}from"./useBasicLayout-67c5ef4f.js";import"./index-80faaafb.js";import"./index.vue_vue_type_script_setup_true_lang-aaaaaf62.js";import"./hooks-ea9aeb9a.js";function q(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!K(t)}const{isMobile:E}=Y(),c=d({});function ee(){const t=C({name:"",enable:""}),g=d(),f=d([]),r=d(!0),{switchStyle:_}=P(),D=[{label:"菜单编号",prop:"id",hide:!0},{label:"菜单名称",prop:"name",width:180,align:"left"},{label:"图标",prop:"icon",minWidth:60,cellRenderer:({row:a})=>p("div",{class:"flex justify-center"},[p(S,{icon:a.icon},null)])},{label:"状态",minWidth:130,cellRenderer:a=>{var e;return p(y("el-switch"),{size:a.props.size==="small"?"small":"default",loading:(e=c.value[a.index])==null?void 0:e.loading,modelValue:a.row.enable,"onUpdate:modelValue":n=>a.row.enable=n,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:_.value,onChange:()=>x(a)},null)}},{label:"打开类型",prop:"open_type",minWidth:70,cellRenderer:({row:a})=>{var o;const e=[{value:"按钮",text:"info"},{value:"签页内嵌",text:"warning"},{value:"外链跳转",text:"danger"},{value:"目录",text:"success"},{value:"菜单",text:null}],n=a.open_type==="0"?"目录":a.open_type==="1"?"菜单":a.open_type==="2"?"按钮":a.open_type==="3"?"签页内嵌":"外链跳转",m=(o=e.find(s=>s.value===n))==null?void 0:o.text;return p(y("el-tag"),{type:m,effect:"dark"},q(n)?n:{default:()=>[n]})}},{label:"权限标识",prop:"code",minWidth:120},{label:"排序",prop:"sort",minWidth:60},{label:"操作",fixed:"right",width:110,slot:"operation"}];function x({row:a,index:e}){F.confirm(`确认要<strong>${a.enable===0?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${a.name}</strong>菜单吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{c.value[e]=Object.assign({},c.value[e],{loading:!0}),k(a.id).then(n=>{n.code===200?setTimeout(()=>{c.value[e]=Object.assign({},c.value[e],{loading:!1}),l("已成功修改菜单状态",{type:"success"})},200):l(`操作失败，${n.message}`,{type:"error"})})}).catch(()=>{a.enable===0?a.enable=1:a.enable=0})}function M(a){}function T(a){a&&(a.resetFields(),i())}async function i(){r.value=!0;const{data:a}=await B();let e=a;v(t.name)||(e=e.filter(n=>n.name.includes(t.name))),v(t.enable)||(e=e.filter(n=>n.enable===t.enable)),f.value=V(e),setTimeout(()=>{r.value=!1},500)}function b(a){if(!a||!a.length)return;const e=[];for(let n=0;n<a.length;n++)a[n].disabled=a[n].enable===0,b(a[n].children),e.push(a[n]);return e}function $(a="新增",e){W({title:`${a}菜单`,props:{formInline:{title:a,higherDeptOptions:b(U(f.value)),parent_id:(e==null?void 0:e.parent_id)??"0",name:(e==null?void 0:e.name)??"",url:(e==null?void 0:e.url)??"",menu_name:(e==null?void 0:e.menu_name)??"",code:(e==null?void 0:e.code)??"",open_type:(e==null?void 0:e.open_type)??0,icon:(e==null?void 0:e.icon)??"ep:add-location",sort:(e==null?void 0:e.sort)??1,enable:(e==null?void 0:e.enable)??1}},width:"40%",draggable:!0,fullscreenIcon:!0,fullscreen:!!E.value,closeOnClickModal:!1,contentRenderer:()=>z(j,{ref:g}),beforeSure:(n,{options:m})=>{const o=g.value.getRef(),s=m.props.formInline;function h(){l(`您${a}了菜单名称为${s.name}的这条数据`,{type:"success"}),n(),i()}o.validate(R=>{R&&(delete s.higherDeptOptions,a==="新增"?H(s).then(async u=>{u.code===200?await h():l(`操作失败，${u.message}`,{type:"error"})}):a==="编辑"&&N(e==null?void 0:e.id,s).then(async u=>{u.code===200?await h():l(`操作失败，${u.message}`,{type:"error"})}))})}})}function O(a){A(a.id).then(async e=>{e.code===200?(l(`您删除了菜单名称为${a.name}的这条数据`,{type:"success"}),await i()):l(`操作失败，${e.message}`,{type:"error"})})}return I(()=>{i()}),{form:t,loading:r,columns:D,dataList:f,onSearch:i,resetForm:T,openDialog:$,handleDelete:O,handleSelectionChange:M}}export{ee as useDept};
