import{Y as m,k as p,t as w,e as r,r as h,ar as Y,ay as i,aH as v,aI as j,ae as A,M as x,aJ as E,aK as O}from"./index-6f723797.js";import{e as $,f as B,h as H}from"./monitor-98a23e5d.js";import{_ as I}from"./description.vue_vue_type_style_index_0_lang-d77bb804.js";import{E as L}from"./xdteam-1bd5232c.js";import{u as N}from"./useBasicLayout-67c5ef4f.js";function F(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!O(o)}const{isMobile:b}=N();function U(o){const l=m({uid:"",status:"",operation:"",module:"",currentPage:1,pageSize:10}),s=p([]),c=p(!0),u=p(0),g=m({total:0,pageSize:10,currentPage:1,pageSizes:[10,20,50,100],background:!0}),y=e=>(l.currentPage-1)*l.pageSize+e+1,S=()=>{L(s,f)},f=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:y,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"业务模块",prop:"module",minWidth:160,cellRenderer:({row:e})=>r("span",{style:{color:"blue"}},[e.module])},{label:"用户",prop:"uid",minWidth:100},{label:"操作类型",prop:"operation",minWidth:100,cellRenderer:({row:e,props:t})=>{const a=[{value:0,text:"其他"},{value:1,text:"修改"},{value:2,text:"添加"},{value:3,text:"删除"},{value:4,text:"登录"},{value:5,text:"上传"}],k=[{value:0,text:""},{value:1,text:null},{value:2,text:"warning"},{value:3,text:"danger"},{value:4,text:"success"},{value:5,text:"info"}],d=a[e.operation].text,_=k[e.operation].text;return r(h("el-tag"),{size:t.size,type:_,effect:"dark"},F(d)?d:{default:()=>[d]})}},{label:"请求方式",prop:"method",minWidth:100,cellRenderer:({row:e})=>{let t="",a="";return a=e.request_params.method,a=="GET"?t="green":a=="POST"?t="#e6a23c":a=="PUT"?t="blue":t="red",r("span",{style:{color:t}},[a])}},{label:"IP地址",prop:"ip",minWidth:100},{label:"状态",prop:"status",minWidth:100,cellRenderer:({row:e,props:t})=>r(h("el-tag"),{size:t.size,type:e.status===0?"danger":"success",effect:"dark"},{default:()=>[e.status===0?"失败":"成功"]})},{label:"访问时间",minWidth:180,prop:"create_time",formatter:({create_time:e})=>Y(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function z(e){$(e.id).then(async t=>{t.code===200?(i(`您删除了日志ID为${e.id}的这条数据`,{type:"success"}),await n()):i(`操作失败，${t.message}`,{type:"error"})})}function T(e){u.value=e.length,o.value.setAdaptive()}function D(){u.value=0,o.value.getTableRef().clearSelection()}function C(){const e=o.value.getTableRef().getSelectionRows();B(v(e,"id")).then(async t=>{t.code===200?(i(`已删除日志编号为 ${v(e,"id")} 的数据`,{type:"success"}),await n()):i(`操作失败，${t.message}`,{type:"error"}),o.value.getTableRef().clearSelection()})}function P(e){l.currentPage=1,l.pageSize=e,n()}function R(e){l.currentPage=e,n()}function W(e){j({title:"日志详情",width:"60%",draggable:!0,fullscreen:!!b.value,closeOnClickModal:!0,contentRenderer:()=>A(I,x(e)),footerButtons:[{label:"关闭",text:!0,size:"large",bg:!0,btnClick:({dialog:{options:t,index:a}})=>{E(t,a)}}]})}async function n(){c.value=!0;const{data:e}=await H(x(l));s.value=e.results,g.total=e.total,setTimeout(()=>{c.value=!1},500)}const M=e=>{e&&(e.resetFields(),n())};return w(()=>{n()}),{form:l,loading:c,columns:f,dataList:s,exportExcel:S,selectedNum:u,pagination:g,isMobile:b,onbatchDel:C,openDialog:W,onSearch:n,resetForm:M,handleDelete:z,onSelectionCancel:D,handleSizeChange:P,handleCurrentChange:R,handleSelectionChange:T}}export{U as useRole};
