import{Y as M,k as l,t as O,ar as R,ay as a,aH as C,M as j,aI as Y,ae as F}from"./index-6f723797.js";import I from"./form-bcd7f46f.js";import{d as N,m as U,a as X,g as q,e as G,f as J}from"./dock-ec7e72b8.js";import{u as Q}from"./useBasicLayout-67c5ef4f.js";import{E as V}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";const{isMobile:A}=Q();function oe(p){const o=M({name:"",currentPage:1,pageSize:10}),u=l(),f=l([]),g=l(!0),h=l(0),b=M({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),H=e=>(o.currentPage-1)*o.pageSize+e+1,P=()=>{V(f,$)},$=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:H,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"脚本名称",prop:"name",minWidth:100},{label:"脚本路径",prop:"path",minWidth:80},{label:"脚本大小",prop:"size",minWidth:80},{label:"修改时间",minWidth:160,prop:"update_time",formatter:({update_time:e})=>R(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:190,slot:"operation"}];function T(e){N(e.id).then(async t=>{t.code===200?(a(`您删除了脚本ID为${e.id}的这条数据`,{type:"success"}),await c()):a(`操作失败，${t.message}`,{type:"error"})})}const y=l();function W(e){h.value=e.length,p.value.setAdaptive()}function k(){h.value=0,p.value.getTableRef().clearSelection()}function E(){const e=p.value.getTableRef().getSelectionRows();U(C(e,"id")).then(async t=>{t.code===200?(a(`已删除脚本编号为 ${C(e,"id")} 的数据`,{type:"success"}),await c()):a(`操作失败，${t.message}`,{type:"error"}),p.value.getTableRef().clearSelection()})}function _(e){o.currentPage=1,o.pageSize=e,c()}function B(e){o.currentPage=e,c()}async function c(){g.value=!0;const{data:e}=await X(j(o));f.value=e.results,b.total=e.total,setTimeout(()=>{g.value=!1},500)}const K=e=>{e&&(e.resetFields(),c())};function L(e="新增",t){const x=`# -*- coding:utf-8 -*-
"""
@Created on : ${R().format("YYYY/MM/DD HH:mm:ss")}
@Author: XDTEAM
@Des: 
"""

`;e==="编辑"?q(t==null?void 0:t.name).then(async i=>{if(i.code!==200)return a(`操作失败，${i.message}`,{type:"error"}),"";y.value=i.data,Y({title:`${e}脚本`,props:{formInline:{title:e,name:(t==null?void 0:t.name)??"",content:y.value??x}},draggable:!0,fullscreen:!0,closeOnClickModal:!1,contentRenderer:()=>F(I,{ref:u}),beforeSure:(S,{options:v})=>{const n=u.value.getRef(),s=v.props.formInline;n.validate(r=>{if(r){const m=s.content,D=m.length/1024;s.name.slice(-3)!==".py"&&(s.name=s.name+".py");const d={content:m,size:`${D.toFixed(2)}KB`,name:s.name,path:`/scripts/${s.name}`};G(t==null?void 0:t.id,d).then(async z=>{z.code===200?(a("操作成功，请稍后手动刷新",{type:"success"}),S()):a(`操作失败，${z.message}`,{type:"error"})})}})}})}):Y({title:`${e}脚本`,props:{formInline:{title:e,name:(t==null?void 0:t.name)??"",content:y.value??x}},draggable:!0,width:"70%",fullscreenIcon:!0,fullscreen:!!A.value,closeOnClickModal:!1,contentRenderer:()=>F(I,{ref:u}),beforeSure:(i,{options:S})=>{const v=u.value.getRef(),n=S.props.formInline;v.validate(s=>{if(s){const r=n.content;if(r==="")a("操作失败，脚本内容不符合要求",{type:"error"});else{const m=r.length/1024;n.name.slice(-3)!==".py"&&(n.name=n.name+".py");const D={content:r,size:`${m.toFixed(2)}KB`,name:n.name,path:`/scripts/${n.name}`};J(D).then(async d=>{d.code===200?(a("操作成功，请稍后手动刷新",{type:"success"}),i()):a(`操作失败，${d.message}`,{type:"error"})})}}})}})}return O(()=>{c()}),{form:o,loading:g,columns:$,dataList:f,selectedNum:h,pagination:b,isMobile:A,onbatchDel:E,exportExcel:P,onSearch:c,resetForm:K,openDialog:L,handleDelete:T,onSelectionCancel:k,handleSizeChange:_,handleCurrentChange:B,handleSelectionChange:W}}export{oe as useRole};
