import{Y as v,k as r,t as I,e as Y,r as k,ar as A,aN as E,ay as t,aH as y,M as L,aI as j,ae as N}from"./index-6f723797.js";import{_ as O}from"./form.vue_vue_type_script_setup_true_lang-0e7c66b2.js";import{U as V,d as q,m as G,g as J,c as K,a as Q}from"./main-d5644e1a.js";import{u as X}from"./useBasicLayout-67c5ef4f.js";import{u as Z}from"./hooks-2dd4676b.js";import{E as w}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";const{isMobile:S}=X();function oe(c){const s=v({user_id:"",user_level:"",enable:"",currentPage:1,pageSize:10}),m=r(),u=r([]),d=r(!0),p=r(0),i=r({}),{switchStyle:_}=Z(),f=v({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),D=e=>(s.currentPage-1)*s.pageSize+e+1,x=()=>{w(u,h)},h=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:D,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"用户账号",prop:"user_id",minWidth:120},{label:"用户身份",prop:"user_level",minWidth:120},{label:"用户余额",sortable:!0,prop:"balance",minWidth:120},{label:"购买折扣",sortable:!0,prop:"discount",minWidth:120},{label:"状态",prop:"enable",minWidth:90,cellRenderer:e=>{var a;return Y(k("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=i.value[e.index])==null?void 0:a.loading,modelValue:e.row.enable,"onUpdate:modelValue":l=>e.row.enable=l,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:_.value,onChange:()=>$(e)},null)}},{label:"修改时间",minWidth:180,sortable:!0,prop:"update_time",formatter:({update_time:e})=>A(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function $({row:e,index:a}){E.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.name}</strong>用户吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[a]=Object.assign({},i.value[a],{loading:!0}),V(e.id).then(l=>{l.code===200?setTimeout(()=>{i.value[a]=Object.assign({},i.value[a],{loading:!1}),t("已成功修改用户状态",{type:"success"})},200):t(`操作失败，${l.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function C(e){q(e.id).then(async a=>{a.code===200?(t(`您删除了用户ID为${e.id}的这条数据`,{type:"success"}),await n()):t(`操作失败，${a.message}`,{type:"error"})})}function U(e){p.value=e.length,c.value.setAdaptive()}function M(){p.value=0,c.value.getTableRef().clearSelection()}function z(){const e=c.value.getTableRef().getSelectionRows();G(y(e,"id")).then(async a=>{a.code===200?(t(`已删除用户编号为 ${y(e,"id")} 的数据`,{type:"success"}),await n()):t(`操作失败，${a.message}`,{type:"error"}),c.value.getTableRef().clearSelection()})}function R(e){s.currentPage=1,s.pageSize=e,n()}function T(e){s.currentPage=e,n()}async function n(){d.value=!0;const{data:e}=await J(L(s));u.value=e.results,f.total=e.total,setTimeout(()=>{d.value=!1},500)}const W=e=>{e&&(e.resetFields(),n())};function F(e="新增",a){j({title:`${e}用户`,props:{formInline:{title:e,user_id:(a==null?void 0:a.user_id)??"",user_level:(a==null?void 0:a.user_level)??"",balance:(a==null?void 0:a.balance)??"",discount:(a==null?void 0:a.discount)??"",enable:(a==null?void 0:a.enable)??1}},width:"46%",draggable:!0,fullscreenIcon:!0,fullscreen:!!S.value,closeOnClickModal:!1,contentRenderer:()=>N(O,{ref:m}),beforeSure:(l,{options:P})=>{const B=m.value.getRef(),g=P.props.formInline;function b(){t(`您${e}了用户为${g.user_id}的这条数据`,{type:"success"}),l(),n()}B.validate(H=>{H&&(e==="新增"?K(g).then(async o=>{o.code===200?await b():t(`操作失败，${o.message}`,{type:"error"})}):e==="编辑"&&Q(a==null?void 0:a.id,g).then(async o=>{o.code===200?await b():t(`操作失败，${o.message}`,{type:"error"})}))})}})}return I(()=>{n()}),{form:s,loading:d,columns:h,dataList:u,selectedNum:p,pagination:f,isMobile:S,exportExcel:x,onbatchDel:z,onSearch:n,resetForm:W,openDialog:F,handleDelete:C,onSelectionCancel:M,handleSizeChange:R,handleCurrentChange:T,handleSelectionChange:U}}export{oe as useRole};
