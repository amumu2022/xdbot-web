import{aS as c,bi as N,Y as T,k as d,p as V,t as W,ay as l,e as i,bX as z,bY as H,h as b,ar as K,M as P,aI as F,ae as S,r as k,aK as U}from"./index-6f723797.js";import I from"./form-aec00d13.js";import{u as X}from"./useBasicLayout-67c5ef4f.js";import{E as G}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";/* empty css              */const q=a=>c.request("post","/api/v1/file/folds/list",{data:a}),J=a=>c.request("post","/api/v1/file/folds/last/list",{data:a}),Q=a=>c.request("post","/api/v1/file/folds/read",{data:a}),Z=a=>c.request("post","/api/v1/file/folds/add/file",{data:a}),w=a=>c.request("post","/api/v1/file/folds/add/fold",{data:a}),M=a=>c.request("post","/api/v1/file/folds/del",{data:a}),ee=a=>c.request("put","/api/v1/file/folds/edit",{data:a}),{isMobile:x}=X();function te(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!U(a)}const{clipboardValue:ae,copied:se}=N(),ne=a=>{ae.value=a,se.value&&l("复制成功",{type:"success"})};function pe(){const a=T({currentPage:1,pageSize:10}),h=d(),f=d([]),o=d(!0),A=d(0),Y=()=>{G(f,R)},p=d(""),C=d("");function O(){E(p.value)}const R=[{label:"序号",type:"index",minWidth:20},{label:"编号",prop:"id",hide:!0},{label:"路径",prop:"path",hide:!0},{label:"是否文件",prop:"isDir",hide:!0},{label:"后缀",prop:"extension",hide:!0},{label:"名称",prop:"name",sortable:!0,minWidth:120,cellRenderer:({row:t})=>{const e=()=>{$("打开",t)},s=n=>i("div",{style:"display: flex; align-items: center"},[i(k("el-icon"),null,te(n)?n:{default:()=>[n]}),i("span",null,[b("    ")]),i(k("el-button"),{type:t.isDir?"danger":"primary",onClick:e,link:!0},{default:()=>[t.name]})]);return t.isDir?s(i(z,null,null)):s(i(H,null,null))}},{label:"大小",sortable:!0,prop:"size",minWidth:80,cellRenderer:({row:t})=>i("div",null,[t.size,i("span",null,[b(" ")]),b("KB")])},{label:"修改时间",sortable:!0,minWidth:120,prop:"update_time",formatter:({update_time:t})=>K(t).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:150,slot:"operation"}];function j(t){M(t.id).then(async e=>{e.code===200?(l(`您删除了文件ID为${t.id}的这条数据`,{type:"success"}),await m()):l(`操作失败，${e.message}`,{type:"error"})})}const B=V(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]);async function m(){o.value=!0;const{data:t}=await q(P(a));f.value=t.items,C.value=t.path,p.value=t.path,setTimeout(()=>{o.value=!1},500)}async function D(t){const e={route:t};o.value=!0;const{data:s}=await q(e);f.value=s.items,p.value=s.path,setTimeout(()=>{o.value=!1},500)}async function E(t){const e={route:t};o.value=!0;const{data:s}=await J(e);f.value=s.items,p.value=s.path,setTimeout(()=>{o.value=!1},500)}function $(t="打开",e){if(t==="打开"){const s={route:e.path};e.isDir?D(e.path):Q(s).then(async n=>{n.code===200?(e.content=n.data,F({title:`${t}文件`,props:{formInline:{title:t,content:(e==null?void 0:e.content)??"",name:(e==null?void 0:e.name)??"",parent_path:(e==null?void 0:e.parent_path)??"",path:(e==null?void 0:e.path)??""}},width:"46%",draggable:!0,fullscreen:!!x.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>S(I,{ref:h}),beforeSure:(g,{options:r})=>{const v=h.value.getRef(),y=r.props.formInline;function u(){l(`您编辑了文件为${y.name}的这条数据`,{type:"success"}),g(),D(e.parent_path)}v.validate(L=>{L&&ee(y).then(async _=>{_.code===200?await u():l(`操作失败，${_.message}`,{type:"error"})})})}})):l(`操作失败，${n.message}`,{type:"error"})});return}else if(t==="删除"){const s={path:e.path};M(s).then(async n=>{n.code===200?(l(`您删除了文件名为${e.name}的这条数据`,{type:"success"}),await m()):l(`操作失败，${n.message}`,{type:"error"})});return}F({title:`${t}`,props:{formInline:{title:t,content:(e==null?void 0:e.content)??"",name:(e==null?void 0:e.name)??"",path:(e==null?void 0:e.path)??""}},width:"46%",draggable:!0,fullscreen:!!x.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>S(I,{ref:h}),beforeSure:(s,{options:n})=>{const g=h.value.getRef(),r=n.props.formInline;function v(){l(`您${t}了文件为${r.name}的这条数据`,{type:"success"}),s(),m()}g.validate(y=>{y&&(t==="新增文件"?(r.path=p.value,Z(r).then(async u=>{u.code===200?await v():l(`操作失败，${u.message}`,{type:"error"})})):t==="新增文件夹"&&(r.path=p.value,w(r).then(async u=>{u.code===200?await v():l(`操作失败，${u.message}`,{type:"error"})})))})}})}return W(async()=>{m()}),{form:a,loading:o,columns:R,dataList:f,exportExcel:Y,selectedNum:A,isMobile:x,onSearch:m,copyString:ne,BackRoute:O,buttonClass:B,openDialog:$,handleDelete:j}}export{pe as useRole};
