import{Y as b,k as c,t as Y,e as g,r as S,ar as E,aN as L,ay as n,aH as k,M as N,aI as U,ae as V,aK as I}from"./index-6f723797.js";import W from"./form-aad20ccc.js";import{b as _,e as K,f as q,h as G,i as J,j as Q}from"./keyword-e4ee2c3e.js";import{u as X}from"./useBasicLayout-67c5ef4f.js";import{E as Z}from"./xdteam-1bd5232c.js";import{u as ee}from"./hooks-2dd4676b.js";/* empty css              */import"./index-80faaafb.js";const{isMobile:x}=X();function te(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!I(o)}function ue(o){const s=b({keyword:void 0,enable:"",currentPage:1,pageSize:10}),m=c(),u=c([]),d=c(!0),p=c(0),y=b({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),D=e=>(s.currentPage-1)*s.pageSize+e+1,i=c({}),{switchStyle:$}=ee(),w=()=>{Z(u,h)},h=[{label:"列表",type:"selection",width:20},{label:"序号",type:"index",index:D,width:80},{label:"编号",hide:!0,prop:"id"},{label:"函数关键词",prop:"keyword",minWidth:380,cellRenderer:({row:e,props:t})=>g("div",{class:"tag-container",style:"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"},[e.keyword.map(a=>g(S("el-tag"),{size:t.size,type:"",effect:"dark"},te(a)?a:{default:()=>[a]}))])},{label:"状态",prop:"enable",minWidth:80,cellRenderer:e=>{var t;return g(S("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=i.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:$.value,onChange:()=>C(e)},null)}},{label:"修改时间",minWidth:160,prop:"update_time",formatter:({update_time:e})=>E(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function C({row:e,index:t}){L.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.keyword}</strong>关键词吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!0}),_(e.id).then(a=>{a.code===200?setTimeout(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!1}),n("已成功修改关键词状态",{type:"success"})},200):n(`操作失败，${a.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function z(e){K(e.id).then(async t=>{t.code===200?(n(`您删除了ID为${e.id}的这条数据`,{type:"success"}),await l()):n(`操作失败，${t.message}`,{type:"error"})})}function M(e){p.value=e.length,o.value.setAdaptive()}function R(){p.value=0,o.value.getTableRef().clearSelection()}function j(){const e=o.value.getTableRef().getSelectionRows();q(k(e,"id")).then(async t=>{t.code===200?(n(`已删除编号为 ${k(e,"id")} 的数据`,{type:"success"}),await l()):n(`操作失败，${t.message}`,{type:"error"}),o.value.getTableRef().clearSelection()})}function T(e){s.currentPage=1,s.pageSize=e,l()}function F(e){s.currentPage=e,l()}async function l(){d.value=!0;const e=N(s);e.keyword=e.keyword||[],Array.isArray(e.keyword)||(e.keyword=[e.keyword]);const{data:t}=await G(e);u.value=t.results,y.total=t.total,setTimeout(()=>{d.value=!1},500)}const A=e=>{e&&(e.resetFields(),l())};function P(e="新增",t){U({title:`${e}关键词`,props:{formInline:{title:e,keyword:(t==null?void 0:t.keyword)??[],code:(t==null?void 0:t.code)??""}},draggable:!0,fullscreenIcon:!0,width:"70%",fullscreen:!!x.value,closeOnClickModal:!1,contentRenderer:()=>V(W,{ref:m}),beforeSure:(a,{options:B})=>{const H=m.value.getRef(),f=B.props.formInline;function v(){n(`您${e}了关键词为${f.keyword}的这条数据`,{type:"success"}),a(),l()}H.validate(O=>{O&&(e==="新增"?J(f).then(async r=>{r.code===200?await v():n(`操作失败，${r.message}`,{type:"error"})}):e==="编辑"&&Q(t==null?void 0:t.id,f).then(async r=>{r.code===200?await v():n(`操作失败，${r.message}`,{type:"error"})}))})}})}return Y(()=>{l()}),{form:s,loading:d,columns:h,dataList:u,selectedNum:p,pagination:y,onbatchDel:j,exportExcel:w,onSearch:l,resetForm:A,openDialog:P,handleDelete:z,onSelectionCancel:R,handleSizeChange:T,handleCurrentChange:F,handleSelectionChange:M,isMobile:x}}export{ue as useRole};
