import{aS as o,aj as W,p as y,Y as S,k as m,t as Y,e as M,r as j,ar as A,aN as E,ay as l,aH as $,M as L,aI as U,ae as V}from"./index-6f723797.js";import{_ as J}from"./form.vue_vue_type_script_setup_true_lang-b1811f16.js";import{u as G}from"./useBasicLayout-67c5ef4f.js";import{E as K}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";const Q=t=>o.request("post","/api/v1/member/user/list",{data:t}),X=t=>o.request("post","/api/v1/member/user/add",{data:t}),Z=t=>{const n=`/api/v1/member/user/del/${t}`;return o.request("delete",n)},w=t=>o.request("delete","/api/v1/member/user/batch_remove",{data:t}),ee=t=>{const n=`/api/v1/member/user/${t}/status`;return o.request("put",n)},te=(t,n)=>o.request("put",`/api/v1/member/user/${t}/info`,{data:n});function ae(){const{isDark:t}=W(),n=y(()=>({"--el-switch-on-color":"#6abe39","--el-switch-off-color":"#e84749"})),p=y(()=>i=>i===1?{"--el-tag-text-color":t.value?"#6abe39":"#389e0d","--el-tag-bg-color":t.value?"#172412":"#f6ffed","--el-tag-border-color":t.value?"#274a17":"#b7eb8f"}:{"--el-tag-text-color":t.value?"#e84749":"#cf1322","--el-tag-bg-color":t.value?"#2b1316":"#fff1f0","--el-tag-border-color":t.value?"#58191c":"#ffa39e"});return{isDark:t,switchStyle:n,tagStyle:p}}const{isMobile:x}=G();function ie(t){const n=S({name:"",enable:"",currentPage:1,pageSize:10}),p=m(),i=m([]),f=m(!0),g=m(0),c=m({}),{switchStyle:D}=ae(),b=S({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),C=e=>(n.currentPage-1)*n.pageSize+e+1,R=()=>{K(i,v)},v=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:C,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"用户名称",prop:"name",minWidth:80},{label:"状态",prop:"enable",minWidth:100,cellRenderer:e=>{var a;return M(j("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=c.value[e.index])==null?void 0:a.loading,modelValue:e.row.enable,"onUpdate:modelValue":s=>e.row.enable=s,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:D.value,onChange:()=>z(e)},null)}},{label:"用户数据",prop:"data",minWidth:180,cellRenderer:({row:e})=>M("div",null,[JSON.stringify(e.data)])},{label:"修改时间",minWidth:180,prop:"update_time",formatter:({update_time:e})=>A(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function z({row:e,index:a}){E.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.name}</strong>用户吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{c.value[a]=Object.assign({},c.value[a],{loading:!0}),ee(e.id).then(s=>{s.code===200?setTimeout(()=>{c.value[a]=Object.assign({},c.value[a],{loading:!1}),l("已成功修改用户状态",{type:"success"})},200):l(`操作失败，${s.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function T(e){Z(e.id).then(async a=>{a.code===200?(l(`您删除了用户ID为${e.id}的这条数据`,{type:"success"}),await r()):l(`操作失败，${a.message}`,{type:"error"})})}function q(e){g.value=e.length,t.value.setAdaptive()}function F(){g.value=0,t.value.getTableRef().clearSelection()}function I(){const e=t.value.getTableRef().getSelectionRows();w($(e,"id")).then(async a=>{a.code===200?(l(`已删除用户编号为 ${$(e,"id")} 的数据`,{type:"success"}),await r()):l(`操作失败，${a.message}`,{type:"error"}),t.value.getTableRef().clearSelection()})}function P(e){n.currentPage=1,n.pageSize=e,r()}function _(e){n.currentPage=e,r()}async function r(){f.value=!0;const{data:e}=await Q(L(n));i.value=e.results,b.total=e.total,setTimeout(()=>{f.value=!1},500)}const k=e=>{e&&(e.resetFields(),r())};function B(e="新增",a){U({title:`${e}用户`,props:{formInline:{title:e,name:(a==null?void 0:a.name)??"",data:(a==null?void 0:a.data)??void 0}},width:"46%",draggable:!0,fullscreenIcon:!0,fullscreen:!!x.value,closeOnClickModal:!1,contentRenderer:()=>V(J,{ref:p}),beforeSure:(s,{options:H})=>{const N=p.value.getRef(),u=H.props.formInline;function h(){l(`您${e}了用户为${u.name}的这条数据`,{type:"success"}),s(),r()}N.validate(O=>{O&&(e==="新增"?(u.data=JSON.parse(u.data),X(u).then(async d=>{d.code===200?await h():l(`操作失败，${d.message}`,{type:"error"})})):e==="编辑"&&te(a==null?void 0:a.id,u).then(async d=>{d.code===200?await h():l(`操作失败，${d.message}`,{type:"error"})}))})}})}return Y(()=>{r()}),{isMobile:x,form:n,loading:f,columns:v,dataList:i,selectedNum:g,pagination:b,onbatchDel:I,onSearch:r,resetForm:k,exportExcel:R,openDialog:B,handleDelete:T,onSelectionCancel:F,handleSizeChange:P,handleCurrentChange:_,handleSelectionChange:q}}export{ie as useRole};
