import{bi as B,Y as v,k as o,t as H,e as f,r as N,h as k,ar as V,aN as Y,ay as a,aH as C,M as L,aI as j,ae as K}from"./index-6f723797.js";import{_ as G}from"./form.vue_vue_type_style_index_0_lang-51996d71.js";import{U as J,d as q,m as Q,g as X,c as Z,a as w}from"./main-e872c8ee.js";import{u as ee}from"./hooks-2dd4676b.js";import{E as te}from"./xdteam-1bd5232c.js";import{u as ae}from"./useBasicLayout-67c5ef4f.js";import"./index-80faaafb.js";import"./index.vue_vue_type_script_setup_true_lang-aaaaaf62.js";import"./hooks-ea9aeb9a.js";import"./formPrimitive.vue_vue_type_script_setup_true_lang-d7435083.js";const{clipboardValue:ne,copied:le}=B(),{isMobile:S}=ae();function ge(u){const l=v({keyword:"",enable:"",method:"",url:"",currentPage:1,pageSize:10}),g=o(),d=o([]),r=o(!0),p=o(0),i=o({}),{switchStyle:I}=ee(),h=v({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),D=e=>(l.currentPage-1)*l.pageSize+e+1,R=()=>{te(d,b)},b=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:D,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"接口",prop:"keyword",minWidth:100},{label:"接口地址",prop:"url",minWidth:220},{label:"请求方式",prop:"method",minWidth:100},{label:"状态",prop:"enable",minWidth:80,cellRenderer:e=>{var t;return f(N("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=i.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":s=>e.row.enable=s,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:I.value,onChange:()=>x(e)},null)}},{label:"请求类型",prop:"cookie",minWidth:120,cellRenderer:({row:e})=>e.cookie===""||e.cookie===null?f("span",{style:{color:"red"}},[k("不携带CK")]):f("span",{style:{color:"green"}},[k("携带CK")])},{label:"修改时间",minWidth:180,prop:"update_time",formatter:({update_time:e})=>V(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:150,slot:"operation"}];function x({row:e,index:t}){Y.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.keyword}</strong>接口吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!0}),J(e.id).then(s=>{s.code===200?setTimeout(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!1}),a("已成功修改接口状态",{type:"success"})},200):a(`操作失败，${s.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function $(e){q(e.id).then(async t=>{t.code===200?(a(`您删除了接口ID为${e.id}的这条数据`,{type:"success"}),await n()):a(`操作失败，${t.message}`,{type:"error"})})}function P(e){e.headers?e.headers=btoa(encodeURIComponent(e.headers)):e.headers="",e.cookie?e.cookie=btoa(encodeURIComponent(e.cookie)):e.cookie="",e.body?e.body=btoa(encodeURIComponent(e.body)):e.body="",e.rule?e.rule=btoa(encodeURIComponent(e.rule)):e.rule="",e.back_set?e.back_set=btoa(encodeURIComponent(e.back_set)):e.back_set="",ne.value=JSON.stringify(e),le.value?(a("导出成功",{type:"success"}),n()):a("导出失败",{type:"warning"})}function _(e){p.value=e.length,u.value.setAdaptive()}function M(){p.value=0,u.value.getTableRef().clearSelection()}function T(){const e=u.value.getTableRef().getSelectionRows();Q(C(e,"id")).then(async t=>{t.code===200?(a(`已删除接口编号为 ${C(e,"id")} 的数据`,{type:"success"}),await n()):a(`操作失败，${t.message}`,{type:"error"}),u.value.getTableRef().clearSelection()})}function U(e){l.currentPage=1,l.pageSize=e,n()}function A(e){l.currentPage=e,n()}async function n(){r.value=!0;const{data:e}=await X(L(l));d.value=e.results,h.total=e.total,setTimeout(()=>{r.value=!1},500)}const z=e=>{e&&(e.resetFields(),n())};function E(e="新增",t){j({title:`${e}接口`,props:{formInline:{title:e,keyword:(t==null?void 0:t.keyword)??"",url:(t==null?void 0:t.url)??"",method:(t==null?void 0:t.method)??"GET",rule:(t==null?void 0:t.rule)??"",back_set:(t==null?void 0:t.back_set)??"",test:(t==null?void 0:t.test)??"",encode:(t==null?void 0:t.encode)??"utf-8",headers:(t==null?void 0:t.headers)??null,body:(t==null?void 0:t.body)??null,cookie:(t==null?void 0:t.cookie)??null}},width:"46%",draggable:!0,fullscreenIcon:!0,fullscreen:!!S.value,closeOnClickModal:!1,contentRenderer:()=>K(G,{ref:g}),beforeSure:(s,{options:F})=>{const W=g.value.getRef(),m=F.props.formInline;function y(){a(`您${e}了接口为${m.keyword}的这条数据`,{type:"success"}),s(),n()}W.validate(O=>{O&&(e==="新增"?Z(m).then(async c=>{c.code===200?await y():a(`操作失败，${c.message}`,{type:"error"})}):e==="编辑"&&w(t==null?void 0:t.id,m).then(async c=>{c.code===200?await y():a(`操作失败，${c.message}`,{type:"error"})}))})}})}return H(()=>{n()}),{form:l,loading:r,columns:b,dataList:d,selectedNum:p,pagination:h,isMobile:S,OutputFuc:P,exportExcel:R,onbatchDel:T,onSearch:n,resetForm:z,openDialog:E,handleDelete:$,onSelectionCancel:M,handleSizeChange:U,handleCurrentChange:A,handleSelectionChange:_}}export{ge as useRole};
