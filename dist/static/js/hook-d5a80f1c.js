import{Y as v,k as r,t as _,e as f,r as S,ar as A,aN as E,ay as t,aH as T,M as L,aI as U,ae as j}from"./index-6f723797.js";import{_ as N}from"./form.vue_vue_type_script_setup_true_lang-b6b2a6ed.js";import{k as O,l as V,n as G,o as J,p as K,q as Q}from"./keyword-e4ee2c3e.js";import{u as X}from"./hooks-2dd4676b.js";import{u as Z}from"./useBasicLayout-67c5ef4f.js";import{E as w}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";const{isMobile:D}=Z();function oe(u){const l=v({keyword:"",sendType:null,group:"",enable:"",currentPage:1,pageSize:10}),m=r(),c=r([]),d=r(!0),p=r(0),i=r({}),{switchStyle:k}=X(),y=v({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),x=e=>(l.currentPage-1)*l.pageSize+e+1,F=()=>{w(c,h)},h=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:x,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"关键词",prop:"keyword",minWidth:100},{label:"匹配类型",prop:"sendType",minWidth:80,cellRenderer:({row:e,props:a})=>f(S("el-tag"),{size:a.size,type:e.sendType===0?"danger":"success",effect:"dark"},{default:()=>[e.sendType===0?"模糊":"精确"]})},{label:"回复语句",prop:"answer",minWidth:200,align:"left"},{label:"状态",prop:"enable",minWidth:90,cellRenderer:e=>{var a;return f(S("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=i.value[e.index])==null?void 0:a.loading,modelValue:e.row.enable,"onUpdate:modelValue":s=>e.row.enable=s,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:k.value,onChange:()=>$(e)},null)}},{label:"群聊号码",prop:"group",minWidth:100,cellRenderer:({row:e})=>f("span",{style:{color:"blue"}},[e.group])},{label:"修改时间",minWidth:180,prop:"update_time",formatter:({update_time:e})=>A(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function $({row:e,index:a}){E.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.keyword}</strong>关键词吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[a]=Object.assign({},i.value[a],{loading:!0}),O(e.id).then(s=>{s.code===200?setTimeout(()=>{i.value[a]=Object.assign({},i.value[a],{loading:!1}),t("已成功修改关键词状态",{type:"success"})},200):t(`操作失败，${s.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function C(e){V(e.id).then(async a=>{a.code===200?(t(`您删除了关键词ID为${e.id}的这条数据`,{type:"success"}),await n()):t(`操作失败，${a.message}`,{type:"error"})})}function z(e){p.value=e.length,u.value.setAdaptive()}function M(){p.value=0,u.value.getTableRef().clearSelection()}function R(){const e=u.value.getTableRef().getSelectionRows();G(T(e,"id")).then(async a=>{a.code===200?(t(`已删除关键词编号为 ${T(e,"id")} 的数据`,{type:"success"}),await n()):t(`操作失败，${a.message}`,{type:"error"}),u.value.getTableRef().clearSelection()})}function q(e){l.currentPage=1,l.pageSize=e,n()}function W(e){l.currentPage=e,n()}async function n(){d.value=!0;const{data:e}=await J(L(l));c.value=e.results,y.total=e.total,setTimeout(()=>{d.value=!1},500)}const P=e=>{e&&(e.resetFields(),n())};function B(e="新增",a){U({title:`${e}关键词`,props:{formInline:{title:e,keyword:(a==null?void 0:a.keyword)??"",answer:(a==null?void 0:a.answer)??"",sendType:(a==null?void 0:a.sendType)??"",group:(a==null?void 0:a.group)??"",enable:(a==null?void 0:a.enable)??1}},width:"46%",draggable:!0,fullscreenIcon:!0,fullscreen:!!D.value,closeOnClickModal:!1,contentRenderer:()=>j(N,{ref:m}),beforeSure:(s,{options:H})=>{const I=m.value.getRef(),g=H.props.formInline;function b(){t(`您${e}了关键词为${g.keyword}的这条数据`,{type:"success"}),s(),n()}I.validate(Y=>{Y&&(e==="新增"?K(g).then(async o=>{o.code===200?await b():t(`操作失败，${o.message}`,{type:"error"})}):e==="编辑"&&Q(a==null?void 0:a.id,g).then(async o=>{o.code===200?await b():t(`操作失败，${o.message}`,{type:"error"})}))})}})}return _(()=>{n()}),{form:l,isMobile:D,loading:d,columns:h,dataList:c,selectedNum:p,pagination:y,onbatchDel:R,onSearch:n,resetForm:P,exportExcel:F,openDialog:B,handleDelete:C,onSelectionCancel:M,handleSizeChange:q,handleCurrentChange:W,handleSelectionChange:z}}export{oe as useRole};
