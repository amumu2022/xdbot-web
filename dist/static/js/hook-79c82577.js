import{Y as b,k as r,t as H,e as Y,r as A,ar as E,aN as L,ay as a,aH as S,M as j,aI as N,ae as O}from"./index-6f723797.js";import{_ as q}from"./form.vue_vue_type_script_setup_true_lang-c770e756.js";import{_ as G}from"./description.vue_vue_type_style_index_0_lang-eae33156.js";import{U as J,d as K,m as Q,g as X,c as Z,a as w}from"./version-e637f255.js";import{u as ee}from"./useBasicLayout-67c5ef4f.js";import{u as te}from"./hooks-adef1d89.js";import{E as ae}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";const{isMobile:D}=ee();function de(c){const s=b({version:"",content:"",enable:"",currentPage:1,pageSize:10}),m=r(),u=r([]),d=r(!0),p=r(0),l=r({}),{switchStyle:$}=te(),g=b({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),x=e=>(s.currentPage-1)*s.pageSize+e+1,C=()=>{ae(u,h)},h=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:x,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"版本号",sortable:!0,prop:"version",minWidth:80},{label:"skey",prop:"skey",minWidth:140},{label:"更新内容",prop:"content",minWidth:100},{label:"状态",prop:"enable",minWidth:90,cellRenderer:e=>{var t;return Y(A("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=l.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":o=>e.row.enable=o,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:$.value,onChange:()=>M(e)},null)}},{label:"修改时间",minWidth:110,prop:"create_time",formatter:({create_time:e})=>E(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:150,slot:"operation"}];function M({row:e,index:t}){L.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.version}</strong>版本吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{l.value[t]=Object.assign({},l.value[t],{loading:!0}),J(e.id).then(o=>{o.code===200?setTimeout(()=>{l.value[t]=Object.assign({},l.value[t],{loading:!1}),a("已成功修改版本状态",{type:"success"})},200):a(`操作失败，${o.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function V(e){K(e.id).then(async t=>{t.code===200?(a(`您删除了版本ID为${e.id}的这条数据`,{type:"success"}),await n()):a(`操作失败，${t.message}`,{type:"error"})})}function k(e){p.value=e.length,c.value.setAdaptive()}function z(){p.value=0,c.value.getTableRef().clearSelection()}function I(){const e=c.value.getTableRef().getSelectionRows();Q(S(e,"id")).then(async t=>{t.code===200?(a(`已删除版本编号为 ${S(e,"id")} 的数据`,{type:"success"}),await n()):a(`操作失败，${t.message}`,{type:"error"}),c.value.getTableRef().clearSelection()})}function R(e){s.currentPage=1,s.pageSize=e,n()}function T(e){s.currentPage=e,n()}async function n(){d.value=!0;const{data:e}=await X(j(s));u.value=e.results,g.total=e.total,setTimeout(()=>{d.value=!1},500)}const U=e=>{e&&(e.resetFields(),n())};function _(e="新增",t){let o=q;e==="查看"&&(o=G);const F=(t==null?void 0:t.content)??`更新内容
【新增】UI-版本更新内容设置
【新增】后端-版本更新后端实现
【修复】UI-分群管理的消息模式显示错误
【修复】UI-全局设置点击的刷新后崩溃
【修复】后端-用户、角色管理出错
【优化】/
【删除】/
【停用】/
      `;N({title:`${e}版本`,props:{formInline:{title:e,version:(t==null?void 0:t.version)??"",skey:(t==null?void 0:t.skey)??"",content:F}},width:"46%",draggable:!0,fullscreen:!!D.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>O(o,{ref:m}),beforeSure:(v,{options:P})=>{const W=m.value.getRef(),f=P.props.formInline;function y(){a(`您${e}了版本为${f.version}的这条数据`,{type:"success"}),v(),n()}W.validate(B=>{B&&(e==="新增"?Z(f).then(async i=>{i.code===200?await y():a(`操作失败，${i.message}`,{type:"error"})}):e==="编辑"?w(t==null?void 0:t.id,f).then(async i=>{i.code===200?await y():a(`操作失败，${i.message}`,{type:"error"})}):e==="查看"&&v())})}})}return H(async()=>{n()}),{form:s,loading:d,columns:h,dataList:u,exportExcel:C,selectedNum:p,pagination:g,isMobile:D,onbatchDel:I,onSearch:n,resetForm:U,openDialog:_,handleDelete:V,onSelectionCancel:z,handleSizeChange:R,handleCurrentChange:T,handleSelectionChange:k}}export{de as useRole};
