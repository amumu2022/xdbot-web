import{Y as x,k as u,t as I,e as S,r as M,ar as O,aN as U,ay as n,aH as D,M as Y,aI as A,ae as E,aK as L}from"./index-6f723797.js";import{_ as N}from"./form.vue_vue_type_script_setup_true_lang-b7e962b0.js";import{U as V,d as K,m as q,g as G,c as J,a as Q}from"./keyword-e4ee2c3e.js";import{u as X}from"./useBasicLayout-67c5ef4f.js";import{u as Z}from"./hooks-2dd4676b.js";import{E as ee}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";const{isMobile:$}=X();function te(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!L(l)}function ce(l){const o=x({keyword:"",answer:"",power:void 0,enable:void 0,currentPage:1,pageSize:10}),y=u(),p=u([]),f=u(!0),g=u(0),i=u({}),{switchStyle:C}=Z(),h=x({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),T=e=>(o.currentPage-1)*o.pageSize+e+1,k=()=>{ee(p,v)},v=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:T,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"菜单名称",prop:"keyword",minWidth:100},{label:"回复语句",prop:"answer",minWidth:200,align:"left"},{label:"菜单权限",prop:"power",minWidth:70,cellRenderer:({row:e})=>{var d;const t=[{value:"群员",text:"info"},{value:"管理",text:"warning"},{value:"群主",text:"danger"},{value:"超管",text:"success"},{value:"主人",text:null}],a=e.power===1?"群员":e.power===2?"管理":e.power===3?"群主":e.power===4?"超管":"主人",m=(d=t.find(r=>r.value===a))==null?void 0:d.text;return S(M("el-tag"),{type:m,effect:"dark"},te(a)?a:{default:()=>[a]})}},{label:"状态",prop:"enable",minWidth:90,cellRenderer:e=>{var t;return S(M("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=i.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已禁用","inline-prompt":!0,style:C.value,onChange:()=>R(e)},null)}},{label:"更新时间",minWidth:130,sortable:!0,prop:"update_time",formatter:({update_time:e})=>O(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function R({row:e,index:t}){U.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong>菜单编号为<strong style='color:var(--el-color-primary)'>${e.id}</strong>的菜单吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!0}),V(e.id).then(a=>{a.code===200?setTimeout(()=>{i.value[t]=Object.assign({},i.value[t],{loading:!1}),n("已成功修改菜单状态",{type:"success"})},200):n(`操作失败，${a.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function z(e){K(e.id).then(async t=>{t.code===200?(n(`您删除了菜单ID为${e.id}的这条数据`,{type:"success"}),await s()):n(`操作失败，${t.message}`,{type:"error"})})}function j(e){g.value=e.length,l.value.setAdaptive()}function F(){g.value=0,l.value.getTableRef().clearSelection()}function P(){const e=l.value.getTableRef().getSelectionRows();q(D(e,"id")).then(async t=>{t.code===200?(n(`已删除菜单编号为 ${D(e,"id")} 的数据`,{type:"success"}),await s()):n(`操作失败，${t.message}`,{type:"error"}),l.value.getTableRef().clearSelection()})}function W(e){o.currentPage=1,o.pageSize=e,s()}function _(e){o.currentPage=e,s()}async function s(){f.value=!0;const{data:e}=await G(Y(o));p.value=e.results,h.total=e.total,setTimeout(()=>{f.value=!1},500)}const w=e=>{e&&(e.resetFields(),s())};function B(e="新增",t){A({title:`${e}菜单`,props:{formInline:{title:e,keyword:(t==null?void 0:t.keyword)??"",answer:(t==null?void 0:t.answer)??"",power:(t==null?void 0:t.power)??1}},width:"46%",draggable:!0,fullscreen:!!$.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>E(N,{ref:y}),beforeSure:(a,{options:m})=>{const d=y.value.getRef(),r=m.props.formInline;function b(){n(`您${e}了菜单编号为${r.id}的这条数据`,{type:"success"}),a(),s()}d.validate(H=>{H&&(e==="新增"?J(r).then(async c=>{c.code===200?await b():n(`操作失败，${c.message}`,{type:"error"})}):e==="编辑"&&Q(t==null?void 0:t.id,r).then(async c=>{c.code===200?await b():n(`操作失败，${c.message}`,{type:"error"})}))})}})}return I(async()=>{s()}),{form:o,loading:f,columns:v,dataList:p,exportExcel:k,selectedNum:g,pagination:h,isMobile:$,onbatchDel:P,onSearch:s,resetForm:w,openDialog:B,handleDelete:z,onSelectionCancel:F,handleSizeChange:W,handleCurrentChange:_,handleSelectionChange:j}}export{ce as useRole};
