import{Y as p,k as l,t as M,e as f,r as P,ar as R,ay as o,aH as m,M as W,aI as Y,ae as $}from"./index-6f723797.js";import{_ as k}from"./form.vue_vue_type_script_setup_true_lang-839caff3.js";import{i as A,j as I,k as T}from"./upload-8e5aad99.js";import{E as _}from"./xdteam-1bd5232c.js";import{u as E}from"./useBasicLayout-67c5ef4f.js";const{isMobile:F}=E();function K(r){const n=p({currentPage:1,pageSize:10}),g=l(),i=l([]),s=l(!0),c=l(0),u=p({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),h=e=>(n.currentPage-1)*n.pageSize+e+1,b=()=>{_(i,d)},d=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:h,minWidth:90},{label:"图片编号",hide:!0,prop:"id"},{label:"图片名称",prop:"name",minWidth:200},{label:"图片",prop:"href",cellRenderer:({row:e})=>f(P("el-image"),{fit:"cover","preview-teleported":!0,src:e.href,style:"border-radius: 5px","preview-src-list":Array.of(e.href),class:"w-[60px] h-[60px] align-middle"},null),width:160},{label:"mime类型",prop:"mime",minWidth:130},{label:"文件大小",prop:"size",minWidth:100,cellRenderer:({row:e})=>{const t=(e.size/1024).toFixed(2)+" MB";return f("span",{style:{color:"blue"}},[t])}},{label:"上传时间",minWidth:180,prop:"create_time",formatter:({create_time:e})=>R(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:80,slot:"operation"}];function y(e){A(e.id).then(async t=>{t.code===200?(o(`您删除了图片ID为${e.id}的这条数据`,{type:"success"}),await a()):o(`操作失败，${t.message}`,{type:"error"})})}function v(e){c.value=e.length,r.value.setAdaptive()}function S(){c.value=0,r.value.getTableRef().clearSelection()}function x(){const e=r.value.getTableRef().getSelectionRows();I(m(e,"id")).then(async t=>{t.code===200?(o(`已删除图片编号为 ${m(e,"id")} 的数据`,{type:"success"}),await a()):o(`操作失败，${t.message}`,{type:"error"}),r.value.getTableRef().clearSelection()})}function w(e){n.currentPage=1,n.pageSize=e,a()}function z(e){n.currentPage=e,a()}async function a(){s.value=!0;const{data:e}=await T(W(n));i.value=e.results,u.total=e.total,setTimeout(()=>{s.value=!1},500)}const C=e=>{e&&(e.resetFields(),a())};function D(e="新增"){Y({title:`${e}图片`,width:"40%",draggable:!0,showClose:!1,fullscreenIcon:!0,fullscreen:!!F.value,closeOnClickModal:!1,contentRenderer:()=>$(k,{ref:g}),beforeSure:t=>{t(),a()},beforeCancel:t=>{t(),o("上传图片后请刷新列表",{type:"warning"})}})}return M(()=>{a()}),{form:n,loading:s,columns:d,dataList:i,selectedNum:c,pagination:u,onbatchDel:x,exportExcel:b,onSearch:a,resetForm:C,openDialog:D,handleDelete:y,onSelectionCancel:S,handleSizeChange:w,handleCurrentChange:z,handleSelectionChange:v}}export{K as useRole};
