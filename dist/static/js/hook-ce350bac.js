import{bi as E,Y as M,k as u,t as L,e as m,r as v,ar as b,ae as Y,aN as O,ay as a,aH as C,M as V,aI as j}from"./index-6f723797.js";import{_ as N}from"./form.vue_vue_type_script_setup_true_lang-adf5ee59.js";import{s as q}from"./scStatusIndicator-321bfa2f.js";import{U as G,d as J,m as K,g as Q,c as X,a as Z}from"./advert-340ce7f0.js";import{u as w}from"./useBasicLayout-67c5ef4f.js";import{u as ee}from"./hooks-adef1d89.js";import{E as te}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";const{isMobile:R}=w(),{clipboardValue:ae,copied:ne}=E(),le=o=>{ae.value=o,ne.value&&a("复制地址成功",{type:"success"})};function pe(o){const s=M({custom:"",alt:"",src:"",enable:void 0,currentPage:1,pageSize:10}),y=u(),p=u([]),f=u(!0),g=u(0),c=u({}),{switchStyle:_}=ee(),D=M({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),$=e=>(s.currentPage-1)*s.pageSize+e+1,A=()=>{te(p,S)},S=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:$,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"客户名称",prop:"custom",sortable:!0,minWidth:120,cellRenderer:({row:e})=>{const t=()=>{le(e.alt)};return(()=>m(v("el-button"),{type:"primary",onClick:t,link:!0},{default:()=>[e.custom]}))()}},{label:"跳转地址",prop:"alt",minWidth:140},{label:"图片",prop:"src",cellRenderer:({row:e})=>m(v("el-image"),{fit:"cover","preview-teleported":!0,src:e.src,style:"border-radius: 5px","preview-src-list":Array.of(e.src),class:"w-[60px] h-[60px] align-middle"},null),width:100},{label:"状态",prop:"enable",minWidth:90,cellRenderer:e=>{var t;return m(v("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=c.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":n=>e.row.enable=n,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已禁用","inline-prompt":!0,style:_.value,onChange:()=>H(e)},null)}},{label:"创建时间",minWidth:130,sortable:!0,prop:"create_time",formatter:({create_time:e})=>b(e).format("YYYY-MM-DD HH:mm:ss")},{label:"授权",prop:"auth",minWidth:60,cellRenderer({row:e}){const t=e.end_time,n=new Date;let d="info";if(t){const h=new Date(t);d=n<h?"success":"danger"}return Y(q,{type:d,pulse:!0})}},{label:"到期时间",sortable:!0,minWidth:130,prop:"end_time",cellRenderer:({row:e})=>{let t="";return e.end_time?t=b(e.end_time).format("YYYY-MM-DD HH:mm:ss"):t="",m("div",null,[t])}},{label:"操作",fixed:"right",width:110,slot:"operation"}];function H({row:e,index:t}){O.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong>推广编号为<strong style='color:var(--el-color-primary)'>${e.id}</strong>的推广吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{c.value[t]=Object.assign({},c.value[t],{loading:!0}),G(e.id).then(n=>{n.code===200?setTimeout(()=>{c.value[t]=Object.assign({},c.value[t],{loading:!1}),a("已成功修改推广状态",{type:"success"})},200):a(`操作失败，${n.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function T(e){J(e.id).then(async t=>{t.code===200?(a(`您删除了推广ID为${e.id}的这条数据`,{type:"success"}),await l()):a(`操作失败，${t.message}`,{type:"error"})})}function z(e){g.value=e.length,o.value.setAdaptive()}function k(){g.value=0,o.value.getTableRef().clearSelection()}function I(){const e=o.value.getTableRef().getSelectionRows();K(C(e,"id")).then(async t=>{t.code===200?(a(`已删除推广编号为 ${C(e,"id")} 的数据`,{type:"success"}),await l()):a(`操作失败，${t.message}`,{type:"error"}),o.value.getTableRef().clearSelection()})}function W(e){s.currentPage=1,s.pageSize=e,l()}function B(e){s.currentPage=e,l()}async function l(){f.value=!0;const{data:e}=await Q(V(s));p.value=e.results,D.total=e.total,setTimeout(()=>{f.value=!1},500)}const F=e=>{e&&(e.resetFields(),l())};function P(e="新增",t){j({title:`${e}推广`,props:{formInline:{title:e,custom:(t==null?void 0:t.custom)??"",filelist:[],src:(t==null?void 0:t.src)??"",end_time:b(t==null?void 0:t.end_time).format("YYYY-MM-DD HH:mm:ss")??"",alt:(t==null?void 0:t.alt)??""}},width:"46%",draggable:!0,fullscreen:!!R.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>Y(N,{ref:y}),beforeSure:(n,{options:d})=>{const h=y.value.getRef(),i=d.props.formInline;function x(){a(`您${e}了推广编号为${i.custom}的这条数据`,{type:"success"}),n(),l()}h.validate(U=>{U&&(i.filelist=i.filelist.map(r=>r.raw),i.file=i.filelist[0],e==="新增"?X(i).then(async r=>{r.code===200?await x():a(`操作失败，${r.message}`,{type:"error"})}):e==="编辑"&&Z(t==null?void 0:t.id,i).then(async r=>{r.code===200?await x():a(`操作失败，${r.message}`,{type:"error"})}))})}})}return L(async()=>{l()}),{form:s,loading:f,columns:S,dataList:p,exportExcel:A,selectedNum:g,pagination:D,isMobile:R,onbatchDel:I,onSearch:l,resetForm:F,openDialog:P,handleDelete:T,onSelectionCancel:k,handleSizeChange:W,handleCurrentChange:B,handleSelectionChange:z}}export{pe as useRole};
