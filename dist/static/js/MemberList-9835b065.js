import{Y as j,k as w,p as ue,t as ne,ay as o,e as a,r as s,ae as U,h as x,ar as K,aN as ce,aI as X,aH as Z,M as oe,aK as de,d as pe,o as me,c as ge,j as i,aG as ee,f as l,O as te,_ as fe}from"./index-6f723797.js";import{g as _e,U as be,a as he,s as ye,b as I,c as ve,d as ke}from"./group-565bc2d4.js";import{_ as we}from"./TimeForm.vue_vue_type_script_setup_true_lang-85938952.js";import{s as xe}from"./scStatusIndicator-321bfa2f.js";import{u as Se}from"./hooks-2dd4676b.js";import{u as Me}from"./useBasicLayout-67c5ef4f.js";import{E as Ce,a as ae}from"./xdteam-1bd5232c.js";import{P as Re}from"./index-62542beb.js";import{u as Y}from"./hooks-ea9aeb9a.js";import{P as ze,M as Fe}from"./more-filled-2292bc5d.js";import{D as $e}from"./delete-6d738bc7.js";import{d as Pe}from"./search-cc37b371.js";const{isMobile:Q}=Me();function Te(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!de(g)}function re(g){const r=j({bot_id:"",group_name:"",group_id:"",currentPage:1,pageSize:10}),z=w(0),F=w(),h=w([]),S=w(!0),f=w({}),{switchStyle:L}=Se(),P=j({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),c=ue(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]),R=e=>(r.currentPage-1)*r.pageSize+e+1,O=()=>{Ce(h,M)},M=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:R,minWidth:50},{label:"群聊名称",prop:"group_name"},{label:"群聊号码",prop:"group_id",minWidth:100},{label:"群头像",prop:"image",cellRenderer:({row:e})=>{if(ae(e.group_id)){const t=`https://p.qlogo.cn/gh/${e.group_id}/${e.group_id}/100`;return a("span",null,[a(s("el-image"),{style:"border-radius: 5px",fit:"cover","preview-teleported":!0,src:t,lazy:!0,"preview-src-list":Array.of(t),class:"w-[60px] h-[60px] align-middle"},null)])}return a("span",null,[a(s("el-avatar"),{style:"background-color: #77BBAA; color: #FFFFFF;"},{default:()=>[e.group_name[0]]})])},width:160},{label:"状态",prop:"enable",minWidth:80,cellRenderer:e=>{var t;return a(s("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(t=f.value[e.index])==null?void 0:t.loading,modelValue:e.row.enable,"onUpdate:modelValue":n=>e.row.enable=n,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:L.value,onChange:()=>q(e)},null)}},{label:"小管家",width:180,prop:"group_admin",cellRenderer:({row:e,props:t})=>a("div",{class:"tag-container",style:"display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"},[e.group_admin.map(n=>a(s("el-tag"),{size:t.size,type:"",effect:"dark"},Te(n)?n:{default:()=>[n]}))])},{label:"成员数",prop:"member",minWidth:100,cellRenderer:({row:e})=>a("span",{style:{color:"blue"}},[`${e.Ydata.member_count}/${e.Ydata.max_member_count}`])},{label:"授权",prop:"end_time",hide:!0,cellRenderer:({row:e})=>{var t;return(t=e.Auth)==null?void 0:t.end_time}},{label:"授权",prop:"auth",minWidth:60,cellRenderer({row:e}){var v,k;const t=(k=(v=e.data)==null?void 0:v.Auth)==null?void 0:k.end_time,n=new Date;let m="info";if(t){const $=new Date(t);m=n<$?"success":"danger"}return U(xe,{type:m,pulse:!0})}},{label:"操作",fixed:"right",width:60,slot:"operation"}],W=[{label:"序号",type:"index",index:R,minWidth:50},{label:"账号",prop:"user_id"},{label:"群名片",prop:"card",minWidth:100},{label:"昵称",prop:"nickname",minWidth:100},{label:"身份",prop:"role",minWidth:100,cellRenderer:({row:e})=>{if(e.role==="member")return a(s("el-tag"),{class:"ml-2",type:"info",dark:!0},{default:()=>[x("成员")]});if(e.role==="admin")return a(s("el-tag"),{class:"ml-2",type:"info",style:"background-color: #70CA57; color: white;",dark:!0},{default:()=>[x("管理员")]});if(e.role==="owner")return a(s("el-tag"),{class:"ml-2",type:"info",style:"background-color: #E5C416; color: white;",dark:!0},{default:()=>[x("群主")]})}},{label:"头像",prop:"image",cellRenderer:({row:e})=>{if(ae(e.user_id)){const t=`https://q1.qlogo.cn/g?b=qq&nk=${e.user_id}&s=640`;return a("span",null,[a(s("el-image"),{style:"border-radius: 5px",fit:"cover","preview-teleported":!0,src:t,lazy:!0,"preview-src-list":Array.of(t),class:"w-[60px] h-[60px] align-middle"},null)])}return a("span",null,[a(s("el-avatar"),{style:"background-color: #77BBAA; color: #FFFFFF;"},{default:()=>[e.nickname[0]]})])},width:160},{label:"入群时间",prop:"join_time",minWidth:120,formatter:({join_time:e})=>K(e*1e3).format("YYYY-MM-DD HH:mm:ss")},{label:"最近发言",prop:"last_sent_time",minWidth:120,formatter:({last_sent_time:e})=>K(e*1e3).format("YYYY-MM-DD HH:mm:ss")},{label:"禁言",prop:"shut_up_timestamp",minWidth:120,cellRenderer:({row:e})=>e.shut_up_timestamp===0||e.shut_up_timestamp<33159420?a("span",null,[x("未禁言")]):a("span",{style:{color:"red"}},[K(e.shut_up_timestamp*1e3).format("YYYY-MM-DD HH:mm:ss")])},{label:"操作",fixed:"right",width:60,slot:"operation"}];function T(e){z.value=e.length,g.value.setAdaptive()}function V(){z.value=0,g.value.getTableRef().clearSelection()}function q({row:e,index:t}){ce.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.group_name}</strong>?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{f.value[t]=Object.assign({},f.value[t],{loading:!0});const n={bot:r.bot_id,group_id:e.group_id,group_status:e.enable};be(n).then(async m=>{m.code===200?setTimeout(()=>{f.value[t]=Object.assign({},f.value[t],{loading:!1}),o("已成功修改群状态",{type:"success"})},200):(o(`操作失败，${m.message}`,{type:"error"}),S.value=!1)})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function H(e){X({title:"群成员列表",fullscreenIcon:!0,fullscreen:!!Q.value,draggable:!0,closeOnClickModal:!1,contentRenderer:()=>U(le,{bot:r.bot_id,group_id:e.group_id})})}function d(e){var t,n;X({title:"群聊授权",props:{formInline:{cluster:{managementList:e.group_admin},Auth:{end_time:(n=(t=e.data)==null?void 0:t.Auth)==null?void 0:n.end_time}}},draggable:!0,fullscreen:!!Q.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>U(we,{ref:F}),beforeSure:(m,{options:v})=>{const k=F.value.getRef(),$=v.props.formInline;function se(){o(`您编辑了群号为${e.group_id}的这条数据`,{type:"success"}),m(),_()}k.validate(ie=>{ie&&($.bot=r.bot_id,$.group_id=e.group_id,he($).then(async J=>{J.code===200?await se():o(`操作失败，${J.message}`,{type:"error"})}))})}})}async function u(e){const t=await ye(r.bot_id,e.group_id);t.success?o("退出成功",{type:"success"}):o(`操作失败，${t.message}`,{type:"error"}),_()}async function C(e){const t=await I(r.bot_id,e.group_id);t.success?o("群打卡成功",{type:"success"}):o(`操作失败，${t.message}`,{type:"error"}),_()}function y(e){o("界面设计中",{type:"error"})}function b(e){o("界面设计中",{type:"error"})}function B(e){o("界面设计中",{type:"error"})}function D(e){o("界面设计中",{type:"error"})}async function E(){const e=g.value.getTableRef().getSelectionRows(),t=Z(e,"group_id");if(t.length>10){o("操作失败，不能进行超过10组数据的操作",{type:"error"});return}o("批量退群操作进行中",{type:"warning"});for(let n=0;n<t.length;n++)try{if(!(await I(r.bot_id,t[n])).success){o(`操作失败，群号【${t[n]}】退出失败`,{type:"error"});break}if(n<t.length-1){const v=50+Math.random()*450;await new Promise(k=>setTimeout(k,v))}}catch{o(`操作失败，群号【${t[n]}】退出时发生错误`,{type:"error"});break}o("批量退群操作完成",{type:"success"})}async function G(){const e=g.value.getTableRef().getSelectionRows(),t=Z(e,"group_id");if(t.length>10){o("操作失败，不能进行超过10组数据的操作",{type:"error"});return}o("批量签到操作进行中",{type:"warning"});for(let n=0;n<t.length;n++)try{if(!(await I(r.bot_id,t[n])).success){o(`操作失败，群号${t[n]}签到失败`,{type:"error"});break}if(n<t.length-1){const v=50+Math.random()*450;await new Promise(k=>setTimeout(k,v))}}catch{o(`操作失败，群号${t[n]}签到时发生错误`,{type:"error"});break}o("批量签到操作完成",{type:"success"})}function N(e){r.currentPage=1,r.pageSize=e,_()}function p(e){r.currentPage=e,_()}async function _(){S.value=!0;const{data:e}=await ve(r.bot_id,oe(r));h.value=e.results,P.total=e.total,setTimeout(()=>{S.value=!1},500)}const A=e=>{e&&(e.resetFields(),_())};return ne(()=>{_e().then(e=>{e.success&&e.data.length>0?(r.bot_id=e.data[0],_()):o("当前没有机器人在线",{type:"warning"})})}),{form:r,loading:S,columns:M,columnMember:W,dataList:h,pagination:P,buttonClass:c,selectedNum:z,isMobile:Q,onSelectionCancel:V,handleSelectionChange:T,handleAuth:d,handleMegBox:y,handleMember:H,handleBlack:b,handleMemberBlack:B,handleKick:D,onSearch:_,QuitGroup:u,SignGroup:C,onbatchQuit:E,onbatchSign:G,resetForm:A,exportExcel:O,handleSizeChange:N,handleCurrentChange:p}}const Ue=Object.freeze(Object.defineProperty({__proto__:null,useRole:re},Symbol.toStringTag,{value:"Module"})),Be={class:"main"},De=pe({__name:"MemberList",props:{bot:{type:String,required:!0},group_id:{type:String,required:!0}},setup(g){const r=g,z=w(),F=w(),h=w([]),S=j({total:0,pageSize:20,currentPage:1,pageSizes:[20,50,100,150],background:!0});async function f(){M.value=!0;const d=await ke(r.bot,r.group_id,oe(c));h.value=d.data.results,S.total=d.data.total,setTimeout(()=>{M.value=!1},500)}function L(d){c.currentPage=1,c.pageSize=d,f()}function P(d){c.currentPage=d,f()}const c=j({user_id:"",nickname:"",currentPage:1,pageSize:20});ne(()=>{f()});function R(){const d=h.value,u=O(d,c.user_id,c.nickname);h.value=u}function O(d,u,C){return d.filter(y=>{const b=C?y.nickname.includes(C):!0;return(u?y.user_id.toString().includes(u):!0)&&b})}const{loading:M,columnMember:W,buttonClass:T,exportExcel:V,handleKick:q,handleMemberBlack:H}=re(F);return(d,u)=>{const C=s("el-input"),y=s("el-form-item"),b=s("el-button"),B=s("el-form"),D=s("el-dropdown-item"),E=s("el-dropdown-menu"),G=s("el-dropdown"),N=s("pure-table");return me(),ge("div",Be,[a(B,{ref_key:"formRef",ref:z,inline:!0,model:c,class:"search-form bg-bg_color w-[99/100] pl-8 pt-[12px]"},{default:i(()=>[a(y,{label:"用户账号：",prop:"user_id"},{default:i(()=>[a(C,{modelValue:c.user_id,"onUpdate:modelValue":u[0]||(u[0]=p=>c.user_id=p),placeholder:"请输入用户账号",clearable:"",class:"!w-[160px]",onKeyup:u[1]||(u[1]=ee(p=>R(),["enter"]))},null,8,["modelValue"])]),_:1}),a(y,{label:"昵称：",prop:"nickname"},{default:i(()=>[a(C,{modelValue:c.nickname,"onUpdate:modelValue":u[2]||(u[2]=p=>c.nickname=p),placeholder:"请输入用户账号",clearable:"",class:"!w-[160px]",onKeyup:u[3]||(u[3]=ee(p=>R(),["enter"]))},null,8,["modelValue"])]),_:1}),a(y,null,{default:i(()=>[a(b,{type:"primary",icon:l(Y)(l(Pe)),loading:l(M),onClick:R},{default:i(()=>[x(" 搜索 ")]),_:1},8,["icon","loading"])]),_:1})]),_:1},8,["model"]),a(l(Re),{title:"群成员列表",columns:l(W),onRefresh:f},{buttons:i(()=>[a(b,{type:"success",onClick:l(V)},{default:i(()=>[x("导出")]),_:1},8,["onClick"])]),default:i(({size:p,dynamicColumns:_})=>[a(N,{"row-key":"id",ref_key:"tableRef",ref:F,adaptive:"",stripe:"","align-whole":"center",showOverflowTooltip:"","table-layout":"auto",loading:l(M),size:p,data:h.value,columns:_,pagination:S,paginationSmall:p==="small","header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"},onPageSizeChange:L,onPageCurrentChange:P},{operation:i(({row:A})=>[a(G,null,{dropdown:i(()=>[a(E,null,{default:i(()=>[a(D,null,{default:i(()=>[a(b,{class:te(l(T)),link:"",type:"primary",size:p,icon:l(Y)(l($e)),onClick:e=>l(q)(A)},{default:i(()=>[x(" 踢出成员 ")]),_:2},1032,["class","size","icon","onClick"])]),_:2},1024),a(D,null,{default:i(()=>[a(b,{class:te(l(T)),link:"",type:"primary",size:p,icon:l(Y)(l(ze)),onClick:e=>l(H)(A)},{default:i(()=>[x(" 加黑成员 ")]),_:2},1032,["class","size","icon","onClick"])]),_:2},1024)]),_:2},1024)]),default:i(()=>[a(b,{class:"ml-3 mt-[2px]",link:"",type:"primary",size:p,icon:l(Y)(l(Fe))},null,8,["size","icon"])]),_:2},1024)]),_:2},1032,["loading","size","data","columns","pagination","paginationSmall","header-cell-style"])]),_:1},8,["columns"])])}}});const le=fe(De,[["__scopeId","data-v-ee3b559c"]]),Ke=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"}));export{Ke as M,Ue as h,re as u};
