import{Y as f,k as i,t as M,e as r,ar as R,ay as o,aH as m,M as W,aI as A,ae as P}from"./index-6f723797.js";import{_ as Y}from"./form.vue_vue_type_script_setup_true_lang-a3be62b7.js";import{d as $,m as I,g as T}from"./upload-8e5aad99.js";import{u as _}from"./useBasicLayout-67c5ef4f.js";import{E as k}from"./xdteam-1bd5232c.js";const{isMobile:E}=_();function j(l){const n=f({currentPage:1,pageSize:10}),g=i(),s=i([]),c=i(!0),u=i(0),d=f({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),h=e=>(n.currentPage-1)*n.pageSize+e+1,b=()=>{k(s,p)},p=[{label:"列表",type:"selection",minWidth:40},{label:"序号",type:"index",index:h,minWidth:40},{label:"音频编号",hide:!0,prop:"id"},{label:"音频名称",prop:"name",minWidth:120},{label:"音频",prop:"href",cellRenderer:({row:e})=>r("td",null,[r("audio",{controls:!0,ref:"audio",class:"aud",style:"outline: none;"},[r("source",{src:e.href},null)])]),width:320},{label:"mime类型",prop:"mime",minWidth:120},{label:"文件大小",prop:"size",minWidth:80,cellRenderer:({row:e})=>{const t=(e.size/1024).toFixed(2)+" MB";return r("span",{style:{color:"blue"}},[t])}},{label:"上传时间",minWidth:180,prop:"create_time",formatter:({create_time:e})=>R(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:80,slot:"operation"}];function y(e){$(e.id).then(async t=>{t.code===200?(o(`您删除了音频ID为${e.id}的这条数据`,{type:"success"}),await a()):o(`操作失败，${t.message}`,{type:"error"})})}function S(e){u.value=e.length,l.value.setAdaptive()}function v(){u.value=0,l.value.getTableRef().clearSelection()}function x(){const e=l.value.getTableRef().getSelectionRows();I(m(e,"id")).then(async t=>{t.code===200?(o(`已删除音频编号为 ${m(e,"id")} 的数据`,{type:"success"}),await a()):o(`操作失败，${t.message}`,{type:"error"}),l.value.getTableRef().clearSelection()})}function w(e){n.currentPage=1,n.pageSize=e,a()}function z(e){n.currentPage=e,a()}async function a(){c.value=!0;const{data:e}=await T(W(n));s.value=e.results,d.total=e.total,setTimeout(()=>{c.value=!1},500)}const D=e=>{e&&(e.resetFields(),a())};function C(e="新增"){A({title:`${e}音频`,width:"40%",draggable:!0,showClose:!1,fullscreenIcon:!0,fullscreen:!!E.value,closeOnClickModal:!1,contentRenderer:()=>P(Y,{ref:g}),beforeSure:t=>{t(),a()},beforeCancel:t=>{t(),o("上传音频后请刷新列表",{type:"warning"})}})}return M(()=>{a()}),{form:n,loading:c,columns:p,dataList:s,selectedNum:u,pagination:d,onbatchDel:x,onSearch:a,exportExcel:b,resetForm:D,openDialog:C,handleDelete:y,onSelectionCancel:v,handleSizeChange:w,handleCurrentChange:z,handleSelectionChange:S}}export{j as useRole};
