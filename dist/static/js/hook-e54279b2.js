import{Y as m,k as r,t as k,e as f,h as R,r as W,ar as B,ay as o,aH as h,M as E,aI as F,ae as P}from"./index-6f723797.js";import{_ as T}from"./form.vue_vue_type_script_setup_true_lang-dc7a3386.js";import{b as Y,e as _,f as $}from"./upload-8e5aad99.js";import{E as I}from"./xdteam-1bd5232c.js";import{u as O}from"./useBasicLayout-67c5ef4f.js";const{isMobile:A}=O();function K(l){const n=m({currentPage:1,pageSize:10}),g=r(),i=r([]),s=r(!0),c=r(0),u=m({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),b=e=>(n.currentPage-1)*n.pageSize+e+1,y=()=>{I(i,d)},d=[{label:"列表",type:"selection",minWidth:40},{label:"序号",type:"index",index:b,minWidth:40},{label:"文件编号",hide:!0,prop:"id"},{label:"文件名称",prop:"name",minWidth:120},{label:"文件",prop:"href",cellRenderer:({row:e})=>f(W("el-button"),{type:"success",onClick:()=>p(e)},{default:()=>[R("点击下载")]})},{label:"mime类型",prop:"mime",minWidth:120},{label:"文件大小",prop:"size",minWidth:80,cellRenderer:({row:e})=>{const t=(e.size/1024).toFixed(2)+" MB";return f("span",{style:{color:"blue"}},[t])}},{label:"上传时间",minWidth:180,prop:"create_time",formatter:({create_time:e})=>B(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:80,slot:"operation"}];function p(e){const t=document.createElement("a");t.href=e.href,t.target="_blank",t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function v(e){Y(e.id).then(async t=>{t.code===200?(o(`您删除了文件ID为${e.id}的这条数据`,{type:"success"}),await a()):o(`操作失败，${t.message}`,{type:"error"})})}function S(e){c.value=e.length,l.value.setAdaptive()}function C(){c.value=0,l.value.getTableRef().clearSelection()}function x(){const e=l.value.getTableRef().getSelectionRows();_(h(e,"id")).then(async t=>{t.code===200?(o(`已删除文件编号为 ${h(e,"id")} 的数据`,{type:"success"}),await a()):o(`操作失败，${t.message}`,{type:"error"}),l.value.getTableRef().clearSelection()})}function D(e){n.currentPage=1,n.pageSize=e,a()}function w(e){n.currentPage=e,a()}async function a(){s.value=!0;const{data:e}=await $(E(n));i.value=e.results,u.total=e.total,setTimeout(()=>{s.value=!1},500)}const z=e=>{e&&(e.resetFields(),a())};function M(e="新增"){F({title:`${e}文件`,width:"40%",draggable:!0,showClose:!1,fullscreenIcon:!0,fullscreen:!!A.value,closeOnClickModal:!1,contentRenderer:()=>P(T,{ref:g}),beforeSure:t=>{t(),a()},beforeCancel:t=>{t(),o("上传文件后请刷新列表",{type:"warning"})}})}return k(()=>{a()}),{form:n,loading:s,columns:d,dataList:i,selectedNum:c,pagination:u,onbatchDel:x,onSearch:a,exportExcel:y,resetForm:z,openDialog:M,handleDelete:v,onSelectionCancel:C,handleSizeChange:D,handleDownload:p,handleCurrentChange:w,handleSelectionChange:S}}export{K as useRole};
