import{Y as P,k as o,t as G,M as R,e as r,r as $,ar as J,aN as K,ay as s,aH as z,aI as Q,ae as X}from"./index-6f723797.js";import{_ as Z}from"./form.vue_vue_type_script_setup_true_lang-aca76b0d.js";import{h as w,q as ee,r as ae,s as te,t as ne,u as se,v as le}from"./main-d5644e1a.js";import{u as ie}from"./useBasicLayout-67c5ef4f.js";import{u as ce}from"./hooks-2dd4676b.js";import{E as oe}from"./xdteam-1bd5232c.js";import"./index-80faaafb.js";const{isMobile:M}=ie();function ye(p){const l=P({name:"",category:"",exchange:null,enable:"",currentPage:1,pageSize:10}),h=o([]),v=o(),g=o([]),m=o(!0),f=o(0),u=o({}),{switchStyle:W}=ce(),b=P({total:0,pageSize:10,currentPage:1,pageSizes:[5,10,20,50,100],background:!0}),T=e=>(l.currentPage-1)*l.pageSize+e+1,F=()=>{oe(g,x)},x=[{label:"列表",type:"selection"},{label:"序号",type:"index",index:T,minWidth:50},{label:"编号",hide:!0,prop:"id"},{label:"商品名称",prop:"name",minWidth:100},{label:"分类",prop:"category",minWidth:100},{label:"价格",sortable:!0,prop:"price",minWidth:60},{label:"库存",sortable:!0,prop:"inventory",minWidth:60,cellRenderer:({row:e})=>e.inventory==="0"?r("span",{style:{color:"red"}},[e.inventory]):r("span",null,[e.inventory])},{label:"已售",prop:"sold",sortable:!0,minWidth:60,cellRenderer:({row:e})=>r("span",null,[e.sold?e.sold:0])},{label:"状态",prop:"enable",minWidth:90,cellRenderer:e=>{var a;return r($("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=u.value[e.index])==null?void 0:a.loading,modelValue:e.row.enable,"onUpdate:modelValue":t=>e.row.enable=t,"active-value":!0,"inactive-value":!1,"active-text":"已激活","inactive-text":"已停用","inline-prompt":!0,style:W.value,onChange:()=>A(e)},null)}},{label:"兑换状态",prop:"exchange",minWidth:120,cellRenderer:({row:e,props:a})=>{var t;return r($("el-tag"),{size:a.size,type:((t=e.data)==null?void 0:t.exchange)===1?"success":"danger",effect:"dark"},{default:()=>{var c;return[((c=e.data)==null?void 0:c.exchange)===1?"可以兑换":"不可兑换"]}})}},{label:"兑换价格",sortable:!0,prop:"own_price",minWidth:80,cellRenderer:({row:e})=>{var a,t;return r("span",{style:{color:"blue"}},[(a=e.data)!=null&&a.own_price?(t=e.data)==null?void 0:t.own_price:"0"])}},{label:"修改时间",minWidth:180,sortable:!0,prop:"update_time",formatter:({update_time:e})=>J(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:110,slot:"operation"}];function A({row:e,index:a}){K.confirm(`确认要<strong>${e.enable===!1?"停用":"启用"}</strong><strong style='color:var(--el-color-primary)'>${e.name}</strong>商品吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{u.value[a]=Object.assign({},u.value[a],{loading:!0}),ee(e.id).then(t=>{t.code===200?setTimeout(()=>{u.value[a]=Object.assign({},u.value[a],{loading:!1}),s("已成功修改商品状态",{type:"success"})},200):s(`操作失败，${t.message}`,{type:"error"})})}).catch(()=>{e.enable===0?e.enable=1:e.enable=0})}function B(e){ae(e.id).then(async a=>{a.code===200?(s(`您删除了商品ID为${e.id}的这条数据`,{type:"success"}),await i()):s(`操作失败，${a.message}`,{type:"error"})})}function H(e){f.value=e.length,p.value.setAdaptive()}function I(){f.value=0,p.value.getTableRef().clearSelection()}function N(){const e=p.value.getTableRef().getSelectionRows();te(z(e,"id")).then(async a=>{a.code===200?(s(`已删除商品编号为 ${z(e,"id")} 的数据`,{type:"success"}),await i()):s(`操作失败，${a.message}`,{type:"error"}),p.value.getTableRef().clearSelection()})}function O(e){l.currentPage=1,l.pageSize=e,i()}function Y(e){l.currentPage=e,i()}async function i(){m.value=!0;const{data:e}=await ne(R(l));g.value=e.results,b.total=e.total,setTimeout(()=>{m.value=!1},500)}const E=e=>{e&&(e.resetFields(),i())},C=o(0);function L(e="新增",a){var t,c,S,D,_;if((t=a==null?void 0:a.data)!=null&&t.skeys){const y=(c=a==null?void 0:a.data)==null?void 0:c.skeys.split(`
`).length;C.value=y}Q({title:`${e}商品`,props:{formInline:{title:e,name:(a==null?void 0:a.name)??"",category:(a==null?void 0:a.category)??"",price:Number(a==null?void 0:a.price)??0,inventory:C.value,description:(a==null?void 0:a.description)??"",exchange:(S=a==null?void 0:a.data)==null?void 0:S.exchange,own_price:Number((D=a==null?void 0:a.data)==null?void 0:D.own_price)??0,sold:(a==null?void 0:a.sold)??"0",skeys:((_=a==null?void 0:a.data)==null?void 0:_.skeys)??"",CategoryOptions:h}},width:"46%",draggable:!0,fullscreen:!!M.value,fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>X(Z,{ref:v}),beforeSure:(y,{options:U})=>{const j=v.value.getRef(),n=U.props.formInline;function k(){s(`您${e}了商品为${n.name}的这条数据`,{type:"success"}),y(),i()}j.validate(V=>{if(V){const q={exchange:n.exchange,own_price:n.own_price,skeys:n.skeys};n.data=q,n.inventory=n.skeys.split(`
`).length,e==="新增"?se(n).then(async d=>{d.code===200?await k():s(`操作失败，${d.message}`,{type:"error"})}):e==="编辑"&&le(a==null?void 0:a.id,n).then(async d=>{d.code===200?await k():s(`操作失败，${d.message}`,{type:"error"})})}})}})}return G(async()=>{i();const e=R(l);e.pageSize=1e7;const t=(await w(e)).data.results.map(c=>({value:c.name,label:c.name}));h.value=t}),{form:l,loading:m,columns:x,dataList:g,exportExcel:F,selectedNum:f,pagination:b,isMobile:M,onbatchDel:N,onSearch:i,resetForm:E,openDialog:L,handleDelete:B,onSelectionCancel:I,handleSizeChange:O,handleCurrentChange:Y,handleSelectionChange:H}}export{ye as useRole};
